webpackJsonp([10],{"29sq":function(e,a,t){"use strict";a.a={props:{value:{type:[Object,Boolean]},type:{default:[Number,String]}},data:function(){return{dbSourceList:[],dbInterfaceList:[],dbForm:{source:"",expression:""}}},watch:{dbForm:{handler:function(e){this.$emit("input",e)},deep:!0}},methods:{resetData:function(){this.dbForm={source:"",expression:""}},getDBSourse:function(){var e=this;this.$ajax("rest/target/targetDbSource").then(function(a){e.dbSourceList=a.data.records})},getTargetInterface:function(){var e=this;this.$ajax.get("rest/target/targetInterface",{params:{}}).then(function(a){e.$nextTick(function(){e.dbInterfaceList=a.data.records})})},getData:function(){var e=this;this.$nextTick(function(){1===e.type?e.getDBSourse():e.getTargetInterface()})},checkExpression:function(){return this.dbForm}},updated:function(){},mounted:function(){}}},GHae:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("da-manage-page",[t("div",{attrs:{slot:"button"},slot:"button"},[t("el-button",{attrs:{icon:"my-zengjia"},on:{click:function(a){e.dialogVisible=!0}}},[e._v("新增")])],1),e._v(" "),t("el-form",{attrs:{slot:"search",inline:!0,model:e.searchForm.formdata},slot:"search"},[t("el-form-item",{attrs:{label:"指标名称"}},[t("el-input",{model:{value:e.searchForm.formdata.name,callback:function(a){e.$set(e.searchForm.formdata,"name",a)},expression:"searchForm.formdata.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"指标类型"}},[t("da-select-tree",{attrs:{data:e.targetTypeData,defaultExpandAll:!0},model:{value:e.searchForm.formdata.targetType,callback:function(a){e.$set(e.searchForm.formdata,"targetType",a)},expression:"searchForm.formdata.targetType"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"组织机构"}},[t("da-select-tree",{attrs:{data:e.entOrgData,defaultExpandAll:!0},model:{value:e.searchForm.formdata.orgId,callback:function(a){e.$set(e.searchForm.formdata,"orgId",a)},expression:"searchForm.formdata.orgId"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"指标周期"}},[t("el-select",{attrs:{"auto-complete":"off",filterable:"",size:"medium",placeholder:"请选择"},model:{value:e.searchForm.formdata.targetCycle,callback:function(a){e.$set(e.searchForm.formdata,"targetCycle",a)},expression:"searchForm.formdata.targetCycle"}},e._l(e.targetCycleOptions,function(e,a){return t("el-option",{key:a,attrs:{label:e.dataText,value:parseInt(e.dataValue)}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"取值方式"}},[t("el-select",{attrs:{"auto-complete":"off",filterable:"",size:"medium",placeholder:"请选择"},model:{value:e.searchForm.formdata.valueMethod,callback:function(a){e.$set(e.searchForm.formdata,"valueMethod",a)},expression:"searchForm.formdata.valueMethod"}},e._l(e.valueMethodOptions,function(e,a){return t("el-option",{key:a,attrs:{label:e.dataText,value:parseInt(e.dataValue)}})}))],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.getTbList}},[e._v("查询")])],1)],1),e._v(" "),t("da-table",{ref:"table",attrs:{slot:"content",colums:e.colsData,"table-list":e.tableList,"search-data":e.searchForm,showSelection:!1},on:{callBack:e.getTbList},slot:"content"},[t("el-table-column",{attrs:{slot:"operation",property:"operation",label:"操作",width:"150",align:"center",fixed:"right"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.editTb(a.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.delTb(a.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),t("da-dialog",{staticClass:"target-dialog",attrs:{title:e.title,visible:e.dialogVisible},on:{"update:visible":function(a){e.dialogVisible=a},close:function(a){e.closeDialog("addForm")}}},[t("el-form",{ref:"addForm",staticClass:"fm-line-50p clearfix",attrs:{"label-width":"100px",model:e.addForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"指标名称",prop:"name"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.name,callback:function(a){e.$set(e.addForm,"name",a)},expression:"addForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"指标简称",prop:"shortName"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.shortName,callback:function(a){e.$set(e.addForm,"shortName",a)},expression:"addForm.shortName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"组织机构",prop:"orgId"}},[t("da-select-tree",{attrs:{data:e.entOrgData,defaultExpandAll:!0},model:{value:e.addForm.orgId,callback:function(a){e.$set(e.addForm,"orgId",a)},expression:"addForm.orgId"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"指标类型",prop:"targetType"}},[t("da-select-tree",{attrs:{data:e.targetTypeData,defaultExpandAll:!0},on:{change:e.getTargetUnitList},model:{value:e.addForm.targetType,callback:function(a){e.$set(e.addForm,"targetType",a)},expression:"addForm.targetType"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"指标周期",prop:"targetCycle"}},[t("el-radio-group",{model:{value:e.addForm.targetCycle,callback:function(a){e.$set(e.addForm,"targetCycle",a)},expression:"addForm.targetCycle"}},e._l(e.targetCycleOptions,function(a){return t("el-radio",{key:a.dataValue,attrs:{label:parseInt(a.dataValue)}},[e._v(e._s(a.dataText))])}))],1),e._v(" "),t("el-form-item",{attrs:{label:"指标单位",prop:"unit"}},[t("el-select",{attrs:{"auto-complete":"off",filterable:"",placeholder:"请选择"},model:{value:e.addForm.unit,callback:function(a){e.$set(e.addForm,"unit",a)},expression:"addForm.unit"}},e._l(e.unitOptions,function(e,a){return t("el-option",{key:a,attrs:{label:e.identifyValue,value:e.identify}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"单位换算倍率",prop:"rate"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.rate,callback:function(a){e.$set(e.addForm,"rate",a)},expression:"addForm.rate"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"数据上限",prop:"dataUpperLimit"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.dataUpperLimit,callback:function(a){e.$set(e.addForm,"dataUpperLimit",a)},expression:"addForm.dataUpperLimit"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"数据下限",prop:"dataLowerLimit"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.dataLowerLimit,callback:function(a){e.$set(e.addForm,"dataLowerLimit",a)},expression:"addForm.dataLowerLimit"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"统计上限",prop:"effectiveUpperLimit"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.effectiveUpperLimit,callback:function(a){e.$set(e.addForm,"effectiveUpperLimit",a)},expression:"addForm.effectiveUpperLimit"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"统计下限",prop:"effectiveLowerLimit"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.effectiveLowerLimit,callback:function(a){e.$set(e.addForm,"effectiveLowerLimit",a)},expression:"addForm.effectiveLowerLimit"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"显示位数",prop:"dataDisplayPrecisions"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.dataDisplayPrecisions,callback:function(a){e.$set(e.addForm,"dataDisplayPrecisions",a)},expression:"addForm.dataDisplayPrecisions"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"正常使用",prop:"state"}},[t("el-radio-group",{model:{value:e.addForm.state,callback:function(a){e.$set(e.addForm,"state",a)},expression:"addForm.state"}},e._l(e.stateOptions,function(a){return t("el-radio",{key:a.dataValue,attrs:{label:a.dataValue}},[e._v(e._s(a.dataText))])}))],1),e._v(" "),t("el-form-item",{staticClass:"fm-item-100p",attrs:{label:"取值方式",prop:"valueMethod"}},[t("el-radio-group",{model:{value:e.addForm.valueMethod,callback:function(a){e.$set(e.addForm,"valueMethod",a)},expression:"addForm.valueMethod"}},e._l(e.valueMethodOptions,function(a){return t("el-radio",{key:a.dataValue,attrs:{label:parseInt(a.dataValue)}},[e._v(e._s(a.dataText))])}))],1),e._v(" "),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"0"!==e.addForm.valueMethod,expression:"addForm.valueMethod!=='0'"}],staticClass:"fm-item-100p",attrs:{label:"表达式",prop:"valueSource"}},[t("div",{staticClass:"target-flex"},[t("el-input",{attrs:{row:6,type:"textarea"},model:{value:e.addForm.valueSource,callback:function(a){e.$set(e.addForm,"valueSource",a)},expression:"addForm.valueSource"}}),e._v(" "),t("el-button",{staticClass:"target-valuesource-btn",attrs:{disabled:"0"===e.addForm.valueMethod||!e.addForm.valueMethod},on:{click:e.editExpression}},[e._v("重置")])],1)]),e._v(" "),t("el-form-item",{staticClass:"fm-item-100p",attrs:{label:"描述",prop:"valueContent"}},[t("el-input",{attrs:{row:6,type:"textarea"},model:{value:e.addForm.valueContent,callback:function(a){e.$set(e.addForm,"valueContent",a)},expression:"addForm.valueContent"}})],1),e._v(" "),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1===e.addForm.valueMethod,expression:"addForm.valueMethod===1"}],attrs:{label:"数据源",prop:"sourceId"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.sourceId,callback:function(a){e.$set(e.addForm,"sourceId",a)},expression:"addForm.sourceId"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"直接依赖",prop:"dependence"}},[t("el-input",{attrs:{"auto-complete":"off",disabled:""},model:{value:e.addForm.dependence,callback:function(a){e.$set(e.addForm,"dependence",a)},expression:"addForm.dependence"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"间接依赖",prop:"indirectDependence"}},[t("el-input",{attrs:{"auto-complete":"off",disabled:""},model:{value:e.addForm.indirectDependence,callback:function(a){e.$set(e.addForm,"indirectDependence",a)},expression:"addForm.indirectDependence"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"显示顺序",prop:"showSort"}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addForm.showSort,callback:function(a){e.$set(e.addForm,"showSort",a)},expression:"addForm.showSort"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.saveDialog("addForm")}}},[e._v("确 定")]),e._v(" "),t("el-button",{on:{click:function(a){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),t("da-dialog",{attrs:{title:e.expressionTitle,visible:e.sourceDialogVisible},on:{"update:visible":function(a){e.sourceDialogVisible=a},close:e.expressionClose}},[3===e.addForm.valueMethod?t("da-calculation",{ref:"targetExpression",attrs:{"target-type":e.colsData[2].displace},model:{value:e.expression,callback:function(a){e.expression=a},expression:"expression"}}):e._e(),e._v(" "),1===e.addForm.valueMethod||2===e.addForm.valueMethod?t("data-base",{ref:"targetDBsourse",attrs:{type:e.addForm.valueMethod}}):e._e(),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[3===e.addForm.valueMethod?t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.checkExpression()}}},[e._v("校验")]):e._e(),e._v(" "),t("el-button",{attrs:{type:"primary",disabled:3===e.addForm.valueMethod&&!1===e.expression},on:{click:function(a){e.setExpression()}}},[e._v("保存")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.sourceDialogVisible=!1}}},[e._v("关闭")])],1)],1)],1)},l=[],o={render:r,staticRenderFns:l};a.a=o},KbJL:function(module,__webpack_exports__,__webpack_require__){"use strict";function getTableDataTest(){var e=[{equipType:1,equipTypeName:"中央空调"},{equipType:2,equipTypeName:"抽风机"},{equipType:3,equipTypeName:"新风机"}],a=[{id:1,name:"中央空调1#",type:1},{id:2,name:"中央空调2#",type:1},{id:3,name:"抽风机1#",type:2},{id:4,name:"抽风机2#",type:2},{id:5,name:"新风机1#",type:3}],t=[{id:1,equipId:1,time:"2018-04",dataTime:"2018-04-01",dataValue:52.6},{id:2,equipId:1,time:"2018-05",dataTime:"2018-05-01",dataValue:56.3},{id:3,equipId:2,time:"2018-04",dataTime:"2018-04-01",dataValue:65.6},{id:4,equipId:2,time:"2018-05",dataTime:"2018-05-01",dataValue:64.2},{id:5,equipId:3,time:"2018-04",dataTime:"2018-04-01",dataValue:83.6},{id:6,equipId:3,time:"2018-05",dataTime:"2018-05-01",dataValue:76.6},{id:7,equipId:4,time:"2018-04",dataTime:"2018-04-01",dataValue:42.6},{id:8,equipId:4,time:"2018-05",dataTime:"2018-05-01",dataValue:47.6},{id:9,equipId:5,time:"2018-04",dataTime:"2018-04-01",dataValue:95.6},{id:10,equipId:5,time:"2018-05",dataTime:"2018-05-01",dataValue:88.6}],r={num:3,dataArray:[e,a,t],relation:["equipType,type","id,equipId"],uniqueField:["equipTypeName"],column:[{field:"equipTypeName",formula:"",children:null},{field:"equipId",formula:"COUNT([equipId])",children:null},{field:"time",formula:"OPEN([time])",children:[{field:"dataValue",formula:"SUM([dataValue])",children:null},{field:"scale",formula:"SUM([dataValue])/TOTALX([dataValue])",children:null}]},{field:"ringRatio",formula:"RINGRATIO([dataValue])",children:null}],totalX:[{field:"equipTypeName",formula:"设备合计",children:null},{field:"equipId",formula:"SUM([equipId])",children:null},{field:"time",formula:"",children:[{field:"dataValue",formula:"SUM([dataValue])",children:null},{field:"scale",formula:"1",children:null}]},{field:"ringRatio",formula:"RINGRATIO([dataValue])",children:null}],totalY:[{field:"totalDataValue",formula:"SUM([dataValue])",children:null}]},l=new Date;getTableData(r);var o=new Date;console.log("运算时间："+(o.getTime()-l.getTime())+"毫秒。")}function concatObject(e,a){var t=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(e);for(var r in a)a.hasOwnProperty(r)&&!t.hasOwnProperty(r)&&(t[r]=a[r]);return t}function concatArray(e,a,t){for(var r=[],l={},o=0;o<e.length;o++){for(var i=e[o],n="",s=0;s<t.length;s++)n+=i[t[s]];l[n]=i}for(var d=0;d<a.length;d++){for(var u=a[d],c="",m=0;m<t.length;m++)c+=u[t[m]];var f=l[c];r.push(concatObject(u,f))}return r}function fieldFormulaAnalysis(e,a){var t=[],r=1;for(a.lastIndex=0;r;){var l=a.exec(e);null!=l&&t.push(l[1]),r=a.lastIndex}return t}function getExpressionField(e){var a={count:[],totalX:[],open:[],ringRatio:[],sum:[],avg:[],max:[],min:[]},t=/COUNT\(\[(\w+)\]\)/g,r=/TOTALX\(\[(\w+)\]\)/g,l=/OPEN\(\[(\w+)\]\)/g,o=/RINGRATIO\(\[(\w+)\]\)/g,i=/SUM\(\[(\w+)\]\)/g,n=/AVG\(\[(\w+)\]\)/g,s=/MAX\(\[(\w+)\]\)/g,d=/MIN\(\[(\w+)\]\)/g;if(e instanceof Array)for(var u=0;u<e.length;u++){var c=e[u];if(t.test(c.formula)){var m=fieldFormulaAnalysis(c.formula,t),f={index:u,fields:m.toString()};a.count.push(f)}if(r.test(c.formula)){var p=fieldFormulaAnalysis(c.formula,r),g={index:u,fields:p.toString()};a.totalX.push(g)}if(l.test(c.formula)){var _=fieldFormulaAnalysis(c.formula,l),v={index:u,fields:_.toString()};a.open.push(v)}if(o.test(c.formula)){var h=fieldFormulaAnalysis(c.formula,o),b={index:u,fields:h.toString()};a.ringRatio.push(b)}if(i.test(c.formula)){var x=fieldFormulaAnalysis(c.formula,i),F={index:u,fields:x.toString()};a.sum.push(F)}if(n.test(c.formula)){var D=fieldFormulaAnalysis(c.formula,n),y={index:u,fields:D.toString()};a.avg.push(y)}if(s.test(c.formula)){var O=fieldFormulaAnalysis(c.formula,s),T={index:u,fields:O.toString()};a.max.push(T)}if(d.test(c.formula)){var k=fieldFormulaAnalysis(c.formula,d),j={index:u,fields:k.toString()};a.min.push(j)}}else{var A=e;if(t.test(A.formula)){var L=fieldFormulaAnalysis(A.formula,t),E={index:0,fields:L.toString()};a.count.push(E)}if(r.test(A.formula)){var w=fieldFormulaAnalysis(A.formula,r),C={index:0,fields:w.toString()};a.totalX.push(C)}if(l.test(A.formula)){var M=fieldFormulaAnalysis(A.formula,l),I={index:0,fields:M.toString()};a.open.push(I)}if(o.test(A.formula)){var S=fieldFormulaAnalysis(A.formula,o),V={index:0,fields:S.toString()};a.ringRatio.push(V)}if(i.test(A.formula)){var $=fieldFormulaAnalysis(A.formula,i),R={index:0,fields:$.toString()};a.sum.push(R)}if(n.test(A.formula)){var P=fieldFormulaAnalysis(A.formula,n),U={index:0,fields:P.toString()};a.avg.push(U)}if(s.test(A.formula)){var q=fieldFormulaAnalysis(A.formula,s),B={index:0,fields:q.toString()};a.max.push(B)}if(d.test(A.formula)){var N=fieldFormulaAnalysis(A.formula,d),X={index:0,fields:N.toString()};a.min.push(X)}}return a}function getAllColumn(e){for(var a=[],t=0;t<e.length;t++){var r=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(e[t]);if(a.push(r),r.children&&r.children.length>0){var l=getAllColumn(r.children)||[];a=a.concat(l)}}return a}function getTotalXValue(rstDataList,totalX,allColumns,columnX){var formula=columnX.formula;if(!formula)return"";var colObj=getExpressionField(columnX);if(colObj.open&&colObj.open.length>0)return"";for(var rstDataArray=[],rstkeys=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(rstDataList),i=0;i<rstkeys.length;i++)rstDataArray=rstDataArray.concat(rstDataList[rstkeys[i]]);for(var field=columnX.field,suffix=/\[(.+)\]/g.test(field)?field.match(/\[(.+)\]/g)[0]:"",countField=colObj.count&&colObj.count.length>0?colObj.count[0].fields+suffix:"",maxField=colObj.max&&colObj.max.length>0?colObj.max[0].fields+suffix:"",minField=colObj.min&&colObj.min.length>0?colObj.min[0].fields+suffix:"",sumField=colObj.sum&&colObj.sum.length>0?colObj.sum[0].fields+suffix:"",avgField=colObj.avg&&colObj.avg.length>0?colObj.avg[0].fields+suffix:"",countLst=",",count=0,maxData=rstDataArray[0][maxField]||"",minData=rstDataArray[0][minField]||"",sumData=0,avgSumData=0,avgCount=0,_i2=0;_i2<rstDataArray.length-1;_i2++){var record=rstDataArray[_i2];countField&&-1==countLst.indexOf(","+record[countField]+",")&&(countLst+=record[countField]+",",count++),maxField&&maxData<record[maxField]&&(maxData=record[maxField]),minField&&minData>record[minField]&&(minData=record[minField]),sumField&&record[sumField]&&(sumData+=record[sumField]),avgField&&record[avgField]&&(avgSumData+=record[avgField],avgCount++)}if(colObj.count&&colObj.count.length>0&&(formula=formula.replace(/COUNT\(\[(\w+)\]\)/g,count)),colObj.ringRatio&&colObj.ringRatio.length>0){for(var rField=colObj.ringRatio[0].fields,dataFields=[],k=0;k<allColumns.length;k++)if(/\[(.+)\]/g.test(allColumns[k].field)){var xDataField=allColumns[k].field.replace(/\[(.+)\]/g,"");xDataField==rField&&dataFields.push(allColumns[k].field)}if(!dataFields||dataFields.length<2)formula=formula.replace(/RINGRATIO\(\[(\w+)\]\)/g,0);else{dataFields.sort();var _record=rstDataArray[rstDataArray.length-1],curDataDateF=dataFields[dataFields.length-1],lastDataDateF=dataFields[dataFields.length-2],scaleR=_record[curDataDateF]/_record[lastDataDateF]-1;formula=formula.replace(/RINGRATIO\(\[(\w+)\]\)/g,scaleR)}}if(colObj.sum&&colObj.sum.length>0&&(formula=formula.replace(/SUM\(\[(\w+)\]\)/g,sumData)),colObj.avg&&colObj.avg.length>0){var avgData=avgSumData/avgCount;formula=formula.replace(/AVG\(\[(\w+)\]\)/g,avgData)}if(colObj.max&&colObj.max.length>0&&(formula=formula.replace(/MAX\(\[(\w+)\]\)/g,maxData)),colObj.min&&colObj.min.length>0&&(formula=formula.replace(/MIN\(\[(\w+)\]\)/g,minData)),colObj.totalX&&colObj.totalX.length>0&&(formula=formula.replace(/TOTALX\(\[(\w+)\]\)/g,rstDataArray[rstDataArray.length-1][colObj.totalX[0].fields])),/\(\[(\w+)\]\)/g.test(formula)){var vKeys=formula.match(/\[(.+)\]/g);formula=formula.replace(/\(\[(\w+)\]\)/g,rstDataArray[0][vKeys[0]+suffix])}var data=eval(formula);return data}function getTotalYValue(totalY,allColumns,rstDataArray){for(var i=0;i<totalY.length;i++){for(var totaoYCol=totalY[i],formulaRaw=totaoYCol.formula,colObj=getExpressionField(totaoYCol),countField=colObj.count&&colObj.count.length>0?colObj.count[0].fields:"",maxField=colObj.max&&colObj.max.length>0?colObj.max[0].fields:"",minField=colObj.min&&colObj.min.length>0?colObj.min[0].fields:"",sumField=colObj.sum&&colObj.sum.length>0?colObj.sum[0].fields:"",avgField=colObj.avg&&colObj.avg.length>0?colObj.avg[0].fields:"",countFieldArr=[],maxFieldArr=[],minFieldArr=[],sumFieldArr=[],avgFieldArr=[],j=0;j<allColumns.length;j++){var column=allColumns[j].field.replace(/\[(.+)\]/g,"");column==countField&&countFieldArr.push(allColumns[j].field),column==maxField&&maxFieldArr.push(allColumns[j].field),column==minField&&minFieldArr.push(allColumns[j].field),column==sumField&&sumFieldArr.push(allColumns[j].field),column==avgField&&avgFieldArr.push(allColumns[j].field)}for(var ki=0;ki<rstDataArray.length;ki++){var formula=formulaRaw,record=rstDataArray[ki],countLst=",",count=0,maxData=record[maxFieldArr[0]]||"",minData=record[minFieldArr[0]]||"",sumData=0,avgSumData=0,avgCount=0;if(colObj.count&&colObj.count.length>0){for(var k=0;k<countFieldArr.length;k++)countField&&-1==countLst.indexOf(","+record[countFieldArr[k]]+",")&&(countLst+=record[countFieldArr[k]]+",",count++);formula=formula.replace(/COUNT\(\[(\w+)\]\)/g,count)}if(colObj.ringRatio&&colObj.ringRatio.length,colObj.sum&&colObj.sum.length>0){for(var _k2=0;_k2<sumFieldArr.length;_k2++)sumField&&record[sumFieldArr[_k2]]&&(sumData+=record[sumFieldArr[_k2]]);formula=formula.replace(/SUM\(\[(\w+)\]\)/g,sumData)}if(colObj.avg&&colObj.avg.length>0){for(var _k3=0;_k3<avgFieldArr.length;_k3++)avgField&&record[avgFieldArr[_k3]]&&(avgSumData+=record[avgFieldArr[_k3]],avgCount++);var avgData=avgSumData/avgCount;formula=formula.replace(/AVG\(\[(\w+)\]\)/g,avgData)}if(colObj.max&&colObj.max.length>0){for(var _k4=0;_k4<maxFieldArr.length;_k4++)maxField&&record[maxFieldArr[_k4]]&&(maxData=maxData<record[maxFieldArr[_k4]]?record[maxFieldArr[_k4]]:maxData);formula=formula.replace(/MAX\(\[(\w+)\]\)/g,maxData)}if(colObj.min&&colObj.min.length>0){for(var _k5=0;_k5<minFieldArr.length;_k5++)minField&&record[minFieldArr[_k5]]&&(minData=minData>record[minFieldArr[_k5]]?record[minFieldArr[_k5]]:minData);formula=formula.replace(/MIN\(\[(\w+)\]\)/g,minData)}colObj.totalX&&colObj.totalX.length>0&&(formula=formula.replace(/TOTALX\(\[(\w+)\]\)/g,1)),/\(\[(\w+)\]\)/g.test(formula)&&(formula=formula.replace(/\(\[(\w+)\]\)/g,record[totaoYCol.field]));var data=eval(formula);rstDataArray[ki][totaoYCol.field]=data}}return rstDataArray}function getDataByOperation(allDataArr,dataObj,allColumns,column,colObj,totalX,rstDataList){if(colObj.open&&colObj.open.length>0)return rstDataList;for(var curDataList=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(rstDataList),keys=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(dataObj),field=column.field,suffix=/\[(.+)\]/g.test(field)?field.match(/\[(.+)\]/g)[0]:"",i=0;i<keys.length;i++){for(var uniqueDataList=dataObj[keys[i]],countField=colObj.count&&colObj.count.length>0?colObj.count[0].fields+suffix:"",maxField=colObj.max&&colObj.max.length>0?colObj.max[0].fields+suffix:"",minField=colObj.min&&colObj.min.length>0?colObj.min[0].fields+suffix:"",sumField=colObj.sum&&colObj.sum.length>0?colObj.sum[0].fields+suffix:"",avgField=colObj.avg&&colObj.avg.length>0?colObj.avg[0].fields+suffix:"",countLst=",",count=0,maxData=uniqueDataList[0][maxField]||"",minData=uniqueDataList[0][minField]||"",sumData=0,avgSumData=0,avgCount=0,formula=column.formula,j=0;j<uniqueDataList.length;j++){var record=uniqueDataList[j];countField&&-1==countLst.indexOf(","+record[countField]+",")&&(countLst+=record[countField]+",",count++),maxField&&maxData<record[maxField]&&(maxData=record[maxField]),minField&&minData>record[minField]&&(minData=record[minField]),sumField&&record[sumField]&&(sumData+=record[sumField]),avgField&&record[avgField]&&(avgSumData+=record[avgField],avgCount++)}if(colObj.count&&colObj.count.length>0&&(formula=formula.replace(/COUNT\(\[(\w+)\]\)/g,count)),colObj.ringRatio&&colObj.ringRatio.length>0){for(var rField=colObj.ringRatio[0].fields,dataFields=[],k=0;k<allColumns.length;k++)if(/\[(.+)\]/g.test(allColumns[k].field)){var xDataField=allColumns[k].field.replace(/\[(.+)\]/g,"");xDataField==rField&&dataFields.push(allColumns[k].field)}if(!dataFields||dataFields.length<2)formula=formula.replace(/RINGRATIO\(\[(\w+)\]\)/g,0);else{dataFields.sort();var curDataDateF=dataFields[dataFields.length-1],lastDataDateF=dataFields[dataFields.length-2],scaleR=curDataList[keys[i]][curDataDateF]/curDataList[keys[i]][lastDataDateF]-1;formula=formula.replace(/RINGRATIO\(\[(\w+)\]\)/g,scaleR)}}if(colObj.sum&&colObj.sum.length>0&&(formula=formula.replace(/SUM\(\[(\w+)\]\)/g,sumData)),colObj.avg&&colObj.avg.length>0){var avgData=avgSumData/avgCount;formula=formula.replace(/AVG\(\[(\w+)\]\)/g,avgData)}if(colObj.max&&colObj.max.length>0&&(formula=formula.replace(/MAX\(\[(\w+)\]\)/g,maxData)),colObj.min&&colObj.min.length>0&&(formula=formula.replace(/MIN\(\[(\w+)\]\)/g,minData)),colObj.totalX&&colObj.totalX.length>0){var totalXF=colObj.totalX[0].fields+suffix;formula=formula.replace(/TOTALX\(\[(\w+)\]\)/g,rstDataList[totalX[0].formula][totalXF])}if(/\(\[(\w+)\]\)/g.test(formula)){var vKeys=formula.match(/\[(.+)\]/g);formula=formula.replace(/\(\[(\w+)\]\)/g,uniqueDataList[0][vKeys[0]+suffix])}var data=eval(formula);curDataList[keys[i]][field]=data}return curDataList}function getShowDataList(e,a,t,r,l,o,i,n){var s=l.formula,d={};if(s&&null!=s){var u=getExpressionField(l);o=getDataByOperation(e,a,r,l,u,i,o),n&&(o[i[0].formula][n.field]=getTotalXValue(o,i,r,n))}else{for(var c=0;c<e.length-1;c++)!function(a){var r={},o=e[a][l.field],i="";t.forEach(function(a){i+="_"+e[a],r[a]=e[a]}),r[l.field]=o,d[i]&&d[i]!={}||(d[i]=r)}(c);for(var m=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(o),c=0;c<m.length;c++)o[m[c]]=concatObject(o[m[c]],d[m[c]]);n&&(o[o.length-1][n.field]=getTotalXValue(o,i,r,n))}return o}function getShowFieldDataList(e,a,t){var r=[],l=[],o=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(e);if(!o||o.length<2)return o;if(!o[0].dataValue_key)return o;for(var i={},n=[],s={},d=0,u=0;u<t.length;u++){if(t[u].formula){var c=t[u].field;i[c]=t[u],n.push(c)}var m=t[u].formula;m&&/OPEN\(\[(\w+)\]\)/g.test(m)||(s[t[u].field]=d++)}for(var f=0;f<a.length;f++){var p=a[f].field,g=a[f].formula;g&&/OPEN\(\[(\w+)\]\)/g.test(g)||(r.push(a[f]),n.push(p))}for(var _={},v=0;v<o.length;v++){for(var h={},b=o[v],x="",F=0;F<a.length;F++){var D=a[F].field;h[D]=b[D],b[D]&&(x+="_"+b[D])}if(x){var y=b.dataValue_key;h.dataValue_key=b.dataValue_key,h[y]=b[y];var O={},T=y.replace(/\[(.+)\]/g,"");if(O.field=y,O.formula=i[T].formula,O.children=null,-1==n.indexOf(y)){var k=s[T];r.splice(k,0,O),n.push(y)}var j=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(b);if(j&&j.length>1)for(var A=0;A<j.length;A++)if("********"==b[j[A]]&&/\[(.+)\]/g.test(j[A])){h[j[A]]=b[j[A]];var L={},E=j[A].replace(/\[(.+)\]/g,"");if(L.field=j[A],L.formula=i[E].formula,L.children=null,-1==n.indexOf(j[A])){var w=s[E];r.splice(w,0,L),n.push(j[A])}}var C=_[x]||[];C.push(h),_[x]=C}}for(var M=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(_),I=0;I<M.length;I++){var S=_[M[I]]||[];if(!(S.length<1))if(1==S.length)l.push(S[0]);else{for(var V=S[0],$=1;$<S.length;$++)V=concatObject(V,S[$]);l.push(V)}}return{data:l,column:r}}function openRecordNotOperation(e,a,t,r){var l=getExpressionField(a),o=l.open;if(!o||o.length<1)return e;var i=o[0].fields;if(""==i||i.indexOf(",")>-1)return e;var n=a[o[0].index].children||[];if(!n||n.length<1)return e;for(var s=getExpressionField(n),d=l.open[0].fields,u=0;u<e.length;u++)for(var c=e[u][d],m=0;m<n.length;m++){var f=n[m].field;if(e[u][f]||(e[u][f]="********"),f==r){var p=e[u].dataValue_key||r,g=p+"["+c+"]",_=RegExp(p,"g");e[u]=JSON.parse(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(e[u]).replace(_,g)),delete e[u][d],e[u].dataValue_key=g}else{var v=e[u].dataValue_key,h="";if(v){var b=v.match(/\[(.+)\]/g);h=f+b[0],h=h.replace("["+c+"]","")}else h=f;var x=h+"["+c+"]",F=RegExp(h,"g");void 0!=e[u][h]&&(e[u]=JSON.parse(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(e[u]).replace(F,x)),delete e[u][h])}}return!s.open||s.open.length<1?e:1==s.open.length?openRecordNotOperation(e,a,t,r):e}function getTableDataByManyArray(e){if(!e)return null;var a=e.num,t=e.dataArray,r=e.relation,l=e.column,o=e.uniqueField,i=e.totalY||[],n=e.totalX||[];if(!(a&&t&&r&&l&&o))return null;if(a<1||t.length!=a||r.length!=a-1||o.length<1)return null;var s=[];if(t[0]instanceof Array)t[0].forEach(function(e){s.push(e)});else{if(!(t[0]instanceof Object))return;s.push(t[0])}for(var d=0;d<a-1;d++){(function(e){var a=r[e].split(",")[0],l=r[e].split(",")[1],o={};if(t[e+1]instanceof Array)t[e+1].forEach(function(e){var a=o[e[l]]||[];a.push(e),o[e[l]]=a});else{if(!(t[e+1]instanceof Object))return"continue";o[t[e+1][l]]=t[e+1]}var i=[];s.forEach(function(e){var t=e[a];o[t].forEach(function(a){var t=concatObject(e,a);i.push(t)})}),s=i})(d)}var u=getExpressionField(l);if(!u.open||u.open.length<1);else{for(var c=u.open,m=l[c[0].index],f="";m&&m.children;){var p=m.children,g=getExpressionField(p);if(g.open&&g.open.field&&-1==g.open.field.indexOf(","))m=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(p);else{m=null;for(var _=0;_<p.length;_++){var v=p[_].field;s[0][v]&&(f=v)}}}s=openRecordNotOperation(s,l,o,f)}var h=getAllColumn(l),b=getShowFieldDataList(s,l,h)||{};s=b.data,h=b.column;var x={},F={},D={};s.forEach(function(e){var a="",t={};(o.length=1)?(a=e[o[0]],t[o[0]]=a):(o.forEach(function(r){a+="_"+e[r],t[r]=e[r]}),a=a.substring(1));var r=x[a]||[];r.push(e),x[a]=r,F[a]=r.length,D[a]&&D[a]!={}||(D[a]=t)});var y={},O="";o.forEach(function(e,a){y[e]=n[a].formula,O+="_"+n[a].formula}),D[O.substring(1)]=y;var T=getAllColumn(n)||null,k=[],j={};if(T)for(var d=0;d<T.length;d++)k.push(T[d].field),j[T[d].field]=T[d];var A=[];A.push(T[0]);for(var L=o.length;L<h.length;L++)if(k.indexOf(h[L].field)>-1)A.push(j[h[L].field]);else{var E=h[L].field;if(/\[(.+)\]/g.test(E)){var w=E.replace(/\[(.+)\]/g,"");if(k.indexOf(w)>-1){var C=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(j[w]);C.field=E,A.push(C)}}}for(var M=o.length;M<h.length;M++){var I=A&&A[M]?A[M]:null;D=getShowDataList(s,x,o,h,h[M],D,A,I)}for(var S=[],V=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(D),$=0;$<V.length;$++)S=S.concat(D[V[$]]);return i&&i.length>0&&(S=getTotalYValue(i,h,S)),S}function getTableDataByOneArray(e){if(!e)return null;var a=e.num,t=e.dataArray,r=(e.relation,e.column),l=e.uniqueField,o=e.totalY||[],i=e.totalX||[];if(1!=a||!t||!r||!l)return null;var n=t[0],s=getExpressionField(r);if(!s.open||s.open.length<1);else{for(var d=s.open,u=r[d[0].index],c="";u&&u.children;){var m=u.children,f=getExpressionField(m);if(f.open&&f.open.field&&-1==f.open.field.indexOf(","))u=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(m);else{u=null;for(var p=0;p<m.length;p++){var g=m[p].field;n[0][g]&&(c=g)}}}n=openRecordNotOperation(n,r,l,c)}var _=getAllColumn(r),v=getShowFieldDataList(n,r,_)||{};n=v.data,_=v.column;var h={},b={},x={};n.forEach(function(e){var a="",t={};(l.length=1)?(a=e[l[0]],t[l[0]]=a):(l.forEach(function(r){a+="_"+e[r],t[r]=e[r]}),a=a.substring(1));var r=h[a]||[];r.push(e),h[a]=r,b[a]=r.length,x[a]&&x[a]!={}||(x[a]=t)});var F={},D="";l.forEach(function(e,a){F[e]=i[a].formula,D+="_"+i[a].formula}),x[D.substring(1)]=F;var y=getAllColumn(i)||null,O=[],T={};if(y)for(var k=0;k<y.length;k++)O.push(y[k].field),T[y[k].field]=y[k];var j=[];j.push(y[0]);for(var A=l.length;A<_.length;A++)if(O.indexOf(_[A].field)>-1)j.push(T[_[A].field]);else{var L=_[A].field;if(/\[(.+)\]/g.test(L)){var E=L.replace(/\[(.+)\]/g,"");if(O.indexOf(E)>-1){var w=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__util__.l)(T[E]);w.field=L,j.push(w)}}}for(var C=l.length;C<_.length;C++){var M=j&&j[C]?j[C]:null;x=getShowDataList(n,h,l,_,_[C],x,j,M)}for(var I=[],S=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(x),V=0;V<S.length;V++)I=I.concat(x[S[V]]);return o&&o.length>0&&(I=getTotalYValue(o,_,I)),I}__webpack_require__.d(__webpack_exports__,"a",function(){return getTableDataByOneArray});var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("3cXf"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__("ZLEe"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2__util__=__webpack_require__("yt7g")},NADl:function(e,a,t){var r=t("ZSZL");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);t("FIqI")("0022a34e",r,!0,{})},VVME:function(e,a,t){"use strict";var r=t("YkxX"),l=t("WQVX"),o=t("J0+h"),i=o(r.a,l.a,null,null,null);a.a=i.exports},WQVX:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("el-form",{attrs:{model:e.expressionForm,rules:e.expressionRules}},[t("el-form-item",{attrs:{prop:"expression"}},[t("el-input",{attrs:{readonly:"",type:"textarea",rows:8},nativeOn:{keydown:function(a){e.handleKeyDown(a)}},model:{value:e.expressionForm.expression,callback:function(a){e.$set(e.expressionForm,"expression",a)},expression:"expressionForm.expression"}})],1)],1),e._v(" "),e._l(e.expressionBtn,function(a,r){return t("el-button",{key:r,on:{click:function(t){e.keyUpElement(a)}}},[e._v(e._s(a))])}),e._v(" "),t("el-button",{on:{click:e.backSpace}},[e._v("退格")]),e._v(" "),t("el-button",{on:{click:e.clearAll}},[e._v("清空")]),e._v(" "),t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.expressTableActive,callback:function(a){e.expressTableActive=a},expression:"expressTableActive"}},[t("el-tab-pane",{attrs:{label:"常量",name:"0"}},[e._v("用户管理")]),e._v(" "),t("el-tab-pane",{attrs:{label:"基础指标",name:"1"}},[e._v("配置管理")])],1),e._v(" "),t("da-table",{ref:"expressionTb",attrs:{slot:"content",colums:e.colsData[e.expressTableActive],"table-list":e.tableList,"search-data":e.searchForm[e.expressTableActive],showSelection:!1},on:{callBack:e.getTargetTb},slot:"content"},[t("el-table-column",{attrs:{slot:"operation",property:"operation",label:"操作",width:"150",align:"center",fixed:"right"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.selectRow(a.row)}}},[e._v("选择")])]}}])})],1)],2)},l=[],o={render:r,staticRenderFns:l};a.a=o},YjpV:function(e,a,t){"use strict";var r=t("3cXf"),l=t.n(r),o=t("yt7g"),i=t("VVME"),n=t("aeOv"),s=t("yt7g"),d=t("KbJL");a.a={name:"target",components:{daCalculation:i.a,dataBase:n.a},data:function(){return{targetTypeData:[],entOrgData:[],unitOptions:[],stateOptions:[{dataText:"正常使用",dataValue:!0},{dataText:"停用",dataValue:!1}],targetCycleOptions:[{dataText:"日",dataValue:"3"},{dataText:"月",dataValue:"5"},{dataText:"年",dataValue:"8"}],valueMethodOptions:[{dataText:"手动录入",dataValue:"0"},{dataText:"SQL取值",dataValue:"1"},{dataText:"接口取值",dataValue:"2"},{dataText:"计算取值",dataValue:"3"}],searchForm:{formdata:{name:"",targetType:"",orgId:"",targetCycle:"",valueMethod:""},currentPage:1,pageSize:20},tableList:{},colsData:[{label:"指标名称",prop:"name",align:"left",sortable:!0},{label:"指标简称",prop:"shortName",align:"left",sortable:!0},{label:"指标类型",prop:"targetType",align:"left",sortable:!0,displace:{}},{label:"组织机构",prop:"orgId",align:"left",sortable:!0,displace:{}},{label:"指标周期",prop:"targetCycle",align:"left",sortable:!0,displace:{3:"日",5:"月",8:"年"}},{label:"指标单位",prop:"unit",align:"left",sortable:!0},{label:"取值方式",prop:"valueMethod",align:"left",sortable:!0,displace:{0:"手动录入",1:"SQL取值",2:"接口取值",3:"计算取值",4:"计量点数据"}},{label:"表达式",prop:"valueSource",align:"left",subStr:!0,sortable:!0},{label:"描述",prop:"valueContent",align:"left",sortable:!0}],dialogVisible:!1,addForm:{name:"",shortName:"",targetType:"",orgId:"",targetCycle:3,unit:"",rate:1,dataUpperLimit:"9999999.9999",dataLowerLimit:"-9999999.9999",effectiveUpperLimit:"9999999.9999",effectiveLowerLimit:"-9999999.9999",dataDisplayPrecisions:"2",state:!0,valueMethod:3,valueSource:"",valueContent:"",sourceId:"-1",dependence:"",indirectDependence:"",showSort:"",calculationLevel:""},rules:this.eachValidate({name:{required:!0,maxString:"60"},shortName:{maxString:"60"},rate:{number:!0},targetType:{required:{required:!0,trigger:"change"}},orgId:{required:!0},targetCycle:{required:!0},unit:{maxString:"20"},valueMethod:{required:!0},valueSource:{maxString:"1800"},valueContent:{maxString:"200"}}),sourceDialogVisible:!1,expression:!1,expressionObj:{}}},computed:{title:function(){return this.addForm.id?"编辑指标资料":"新增指标资料"},urlType:function(){return this.addForm.id?"put":"post"},expressionTitle:function(){return["","SQL取值","接口取值","计算取值"][this.addForm.valueMethod]}},watch:{},methods:{getTargetTypeTree:function(e){var a=this;a.$ajax({url:"rest/targetData/targetTypeTree",method:"get"}).then(function(r){if(r.data.status&&(a.targetTypeData=r.data.records,void 0!=e)){var l={};t.i(o.j)(r.data.records,"treeCode","name",l)}})},getTargetTypeList:function(){var e=this;this.$ajax({url:"rest/target/targetType",method:"get"}).then(function(a){if(a.data.status){var t={};e.$each(a.data.records,function(e){t[e.id]=e.name}),e.colsData[2].displace=t}})},getOrgTree:function(e){var a=this,r={title:"指标资料"};r.isAll=!1,r.groupBys="0100000000",a.$ajax({url:"rest/analysisData/departTree",method:"get",params:r}).then(function(r){if(r.data.status&&(a.entOrgData=r.data.records,void 0!=e)){var l={};t.i(o.j)(r.data.records,"treeCode","name",l)}})},getOrgList:function(){var e=this,a=this,t={title:"指标资料"};a.$ajax({url:"rest/analysisData/depart",method:"get",params:t}).then(function(a){if(a.data.status){var t={};e.$each(a.data.records,function(e){t[e.id]=e.name}),e.colsData[3].displace=t}})},getTargetUnitList:function(){var e=this;this.$ajax({url:"rest/target/targetUnit",method:"get",params:{unitType:"",targetType:this.addForm.targetType}}).then(function(a){a.data.status&&(e.unitOptions=a.data.records)})},getTbList:function(){var e=this;this.$ajax.get("rest/target/page",{params:this.searchForm,loadingTarget:this.$refs.table}).then(function(a){a.data.status&&(e.tableList=a.data)})},editTb:function(e){this.dialogVisible=!0,this.addForm=JSON.parse(l()(e))},closeDialog:function(e){this.$nextTick(function(){this.$refs[e].resetFields(),this.addForm={name:"",shortName:"",targetType:"",orgId:"",targetCycle:3,unit:"",rate:1,dataUpperLimit:"9999999.9999",dataLowerLimit:"-9999999.9999",effectiveUpperLimit:"9999999.9999",effectiveLowerLimit:"-9999999.9999",dataDisplayPrecisions:"2",state:!0,valueMethod:3,valueSource:"",valueContent:"",sourceId:"-1",dependence:"",indirectDependence:"",showSort:"",calculationLevel:""}}),this.expression=!1},saveDialog:function(e){var a=this;this.$refs[e].validate(function(e){e&&a.$ajax[a.urlType]("rest/target",a.addForm).then(function(e){e.data.status?(a.$message.success(e.data.answerMsg),a.dialogVisible=!1,a.getTbList()):a.$message.error(e.data.answerMsg)})})},delTb:function(e){var a=this;this.$confirm("是否删除该记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$ajax.delete("rest/target",{params:{id:e.id}}).then(function(e){e.data.status?(a.$message.success(e.data.answerMsg),a.getTbList()):a.$message.error(e.data.answerMsg)})})},editExpression:function(){var e=this;this.sourceDialogVisible=!0,this.$nextTick(function(){switch(e.addForm.valueMethod){case 3:e.$refs.targetExpression.getData(),e.expression={expression:e.addForm.valueContent,expressionTrue:e.addForm.valueSource,level:e.addForm.calculationLevel,dependence:e.addForm.dependence,indirect_dependence:e.addForm.indirectDependence};break;case 2:case 1:e.$refs.targetDBsourse.getData()}})},checkExpression:function(){this.$refs.targetExpression.checkExpression(t.i(s.l)(this.addForm))},setExpression:function(){switch(this.sourceDialogVisible=!1,this.addForm.valueMethod){case 3:this.addForm.valueSource=this.expression.expressionTrue,this.addForm.calculationLevel=this.expression.level,this.addForm.valueContent=this.expression.expression,this.addForm.dependence=this.expression.dependence,this.addForm.indirectDependence=this.expression.indirectDependence;break;case 1:var e=this.$refs.targetDBsourse.checkExpression();this.addForm.valueSource=e.expression,this.addForm.sourceId=e.source}},expressionClose:function(){switch(this.addForm.valueMethod){case 3:this.$refs.targetExpression.resetData();break;case 2:case 1:this.$refs.targetDBsourse.resetData()}},getMeterEnergy:function(){this.$ajax({url:"rest/analysisData/meterEnergyData",method:"get",params:{title:"表计数据测试",orgIds:35,energyIds:35,cycle:3,startTime:"2018-06-01",endTime:"2018-06-30",isCount:!0,groupBys:"0001"}}).then(function(e){if(e.data.status){var a=e.data.records,r={num:1,dataArray:[a],relation:[],uniqueField:["dataTime"],column:[{field:"dataTime",formula:"",children:null},{field:"meterId",formula:"OPEN([meterId])",children:[{field:"displayData",formula:"SUM([displayData])",children:null}]}],totalX:[{field:"dataTime",formula:"合计",children:null},{field:"meterId",formula:"OPEN([meterId])",children:[{field:"displayData",formula:"SUM([displayData])",children:null}]}],totalY:[{field:"合计",formula:"SUM([displayData])",children:null}]},l=new Date,o=t.i(d.a)(r);console.log("rstTableData=",o);var i=new Date;console.log("耗时：",i.getTime()-l.getTime())}})}},mounted:function(){this.getTbList(),this.getTargetTypeTree(),this.getOrgTree(),this.getOrgList(),this.getTargetTypeList(),this.getMeterEnergy()}}},YkxX:function(e,a,t){"use strict";var r=t("yt7g");a.a={props:{value:{type:[Object,Boolean],default:!1},targetType:{type:Object}},data:function(){return{expressTableActive:"0",expressionForm:{expression:"",expressionTrue:"",level:"",dependence:"",indirect_dependence:""},expressionBtn:["SUM()","MAX()","MIN()","AVG()","SD()","(",")","+","*","-","/","0","1","2","3","4","5","6","7","8","9","."],expressTableUrl:["rest/target/targetConstant","rest/target/baseTarget"],expressAttr:["identifyValue","name"],expressTrueAttr:["identify","id"],expressWrap:["{temp}","[temp]"],expressionRules:this.eachValidate({expression:{imeDisabled:!0}}),tableList:{},colsData:[[{label:"常量名称",prop:"identifyValue",align:"left"},{label:"常量代码",prop:"code",align:"left"},{label:"常量值",prop:"identify",align:"left"}],[{label:"指标简称",prop:"shortName",align:"left"},{label:"指标名称",prop:"name",align:"left"},{label:"指标周期",prop:"targetCycle",align:"left"},{label:"指标类型",prop:"targetType",align:"left",displace:this.targetType},{label:"所属组织",prop:"orgId",align:"left",displace:{}}]],searchForm:[{formdata:{},currentPage:1,pageSize:10},{name:"",calculationLevel:"",valueMethod:"",currentPage:1,pageSize:10}]}},watch:{value:function(e){e&&0===this.expressionForm.expression.length&&(this.expressionForm=e)},"expressionForm.expression":function(){this.$emit("input",!1)}},methods:{keyUpElement:function(e){this.expressionForm.expression+=e,this.expressionForm.expressionTrue+=e},handleKeyDown:function(e){},handleClick:function(){this.getTargetTb()},selectRow:function(e){var a=e[this.expressAttr[this.expressTableActive]],t=e[this.expressTrueAttr[this.expressTableActive]];this.expressionForm.expression+=this.expressWrap[this.expressTableActive].replace("temp",a),this.expressionForm.expressionTrue+=this.expressWrap[this.expressTableActive].replace("temp",t)},getTargetTb:function(){var e=this;this.$ajax.get(this.expressTableUrl[this.expressTableActive],{params:this.searchForm[this.expressTableActive]}).then(function(a){e.tableList=a.data})},getOrgTree:function(){var e=this;this.$ajax.get("rest/target/orgTree",{loadingTarget:this.$refs.expressionTb}).then(function(a){var l={};e.$each(t.i(r.b)(a.data.records,"id","children"),function(e){l[e.id]=e.name}),e.colsData[1][4].displace=l})},checkExpression:function(e){var a=this;e.valueSource=this.expressionForm.expressionTrue,this.$ajax.post("rest/target/expressionCheck",e).then(function(e){e.data.status?(a.expressionForm.level=e.data.records.level,a.expressionForm.dependence=e.data.records.dependence,a.expressionForm.indirect_dependence=e.data.records.indirect_dependence,a.$emit("input",a.expressionForm)):a.$message.error(e.data.answerMsg)})},matchChar:function(e){var a="",t=0,r="";if(e.lastIndexOf("]")===e.length-1)a="[",r="]";else{if(e.lastIndexOf("}")!==e.length-1)return e.length-1;a="{",r="}"}for(var l=e.length-2;l>-1;l--){if(0===t&&e[l]===a)return l;e[l]===r?t++:e[l]===a&&t--}},backSpace:function(){var e=this.expressionForm.expression,a=this.expressionForm.expressionTrue;this.expressionForm.expression=this.expressionForm.expression.substring(0,this.matchChar(e)),this.expressionForm.expressionTrue=this.expressionForm.expressionTrue.substring(0,this.matchChar(a))},clearAll:function(){this.resetData()},getData:function(){this.getOrgTree(),this.getTargetTb()},resetData:function(){this.expressionForm={expression:"",expressionTrue:"",level:""}}},mounted:function(){}}},ZSZL:function(e,a,t){a=e.exports=t("acE3")(!0),a.push([e.i,".target-valuesource-btn{margin-left:10px}.target-flex{display:flex}.target-dialog .el-dialog{min-width:630px}","",{version:3,sources:["C:/vscode/ysems_webapp/src/views/platform/target/target.vue"],names:[],mappings:"AACA,wBACE,gBAAkB,CACnB,AACD,aACE,YAAc,CACf,AACD,0BACE,eAAiB,CAClB",file:"target.vue",sourcesContent:["\n.target-valuesource-btn {\r\n  margin-left: 10px;\n}\n.target-flex {\r\n  display: flex;\n}\n.target-dialog .el-dialog {\r\n  min-width: 630px;\n}\r\n"],sourceRoot:""}])},aeOv:function(e,a,t){"use strict";var r=t("29sq"),l=t("hkW3"),o=t("J0+h"),i=o(r.a,l.a,null,null,null);a.a=i.exports},al5a:function(e,a,t){"use strict";function r(e){t("NADl")}Object.defineProperty(a,"__esModule",{value:!0});var l=t("YjpV"),o=t("GHae"),i=t("J0+h"),n=r,s=i(l.a,o.a,n,null,null);a.default=s.exports},hkW3:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("el-form",{attrs:{model:e.dbForm,"label-width":"80px"}},[1===e.type?t("el-form-item",{attrs:{prop:"source"}},[t("el-select",{model:{value:e.dbForm.source,callback:function(a){e.$set(e.dbForm,"source",a)},expression:"dbForm.source"}},e._l(e.dbSourceList,function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e(),e._v(" "),1===e.type?t("el-form-item",{attrs:{prop:"sourceValue"}},[t("el-input",{attrs:{rows:6,type:"textarea"},model:{value:e.dbForm.expression,callback:function(a){e.$set(e.dbForm,"expression",a)},expression:"dbForm.expression"}})],1):e._e(),e._v(" "),2===e.type?t("el-form-item",{attrs:{prop:"source",label:"选择接口"}},[t("el-select",{attrs:{"value-key":"id"},model:{value:e.dbForm.source,callback:function(a){e.$set(e.dbForm,"source",a)},expression:"dbForm.source"}},e._l(e.dbInterfaceList,function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e}})}))],1):e._e(),e._v(" "),2===e.type?t("div",[e._v("接口参数")]):e._e(),e._v(" "),e._l(e.dbForm.source.list,function(a){return 2===e.type?t("el-form-item",{key:a.id,attrs:{prop:"sourceValue","；:label":"item.name"}},[t("el-input",{model:{value:e.dbForm[a.value],callback:function(t){e.$set(e.dbForm,a.value,t)},expression:"dbForm[item.value]"}})],1):e._e()})],2)},l=[],o={render:r,staticRenderFns:l};a.a=o}});
//# sourceMappingURL=10.71ddc33c878e02c4f923.js.map