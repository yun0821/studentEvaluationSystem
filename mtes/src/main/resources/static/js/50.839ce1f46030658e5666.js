webpackJsonp([50],{"/z7V":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("H58q"),s=a("kG2u"),n=a("J0+h"),r=n(i.a,s.a,null,null,null);t.default=r.exports},H58q:function(e,t,a){"use strict";var i=a("yt7g");t.a={data:function(){return{selectTime:"",dateType:5,energyType:"",energyTypeList:[],egyCspStatisticsTableData:[],energyData:[],hb_energyData:[],equipTypeList:[],equipList:[],egyCspProportionData:[],devEgyCspTableData:[],downTimeTableData:[],startTime:"",endTime:"",workshop:"",workshopList:[],equitmentType:"",equitmentList:[],unit:"",egyCspTdcyAnalyzeTime:"",egyCspTdcyAnalyzeData:[],dateFormat:"YYYY-MM",xAxisFormat:"DD日",timeNow:"",bqTimeStr:"本月",hbTimeStr:"上月",bqTime:"",hbTime:"",columnData1:[],columnData2:[],columnData3:[]}},methods:{inintData:function(){var e=this;this.dateType=5;var t=new Date;this.selectTime=a.i(i.g)(this.$moment(t,"YYYY-MM"),-1,5,"YYYY-MM"),this.getTimeFormat(),this.columnData1=this.loadColumn1(),this.columnData2=this.loadColumn2(),this.columnData3=this.loadColumn3(),this.$ajax.all([this.getEquipTypeList(),this.getEnergyTypeList(),this.getWorkshopList(),this.getEquipList()]).then(function(t){t[0].data.status&&(e.equipTypeList=t[0].data.records),t[1].data.status&&(e.energyTypeList=t[1].data.records,e.energyType=35),t[2].data.status&&(e.workshopList=t[2].data.records,null!=t[2].data.records&&t[2].data.records.length>0&&(e.workshop=t[2].data.records[0].id)),t[3].data.status&&(e.equipList=t[3].data.records),e.$nextTick(function(){e.loadData()})})},loadData:function(){this.egyCspStatisticsTableData=[],this.energyData=[],this.hb_energyData=[],this.egyCspProportionData=[],this.devEgyCspTableData=[],this.downTimeTableData=[],this.egyCspTdcyAnalyzeData=[],this.getTimeFormat(),this.columnData1=this.loadColumn1(),this.columnData2=this.loadColumn2(),this.columnData3=this.loadColumn3(),this.getStartEndTime("本期");var e=this.getQueryDataParams();this.getEgyCspStatisticsTable(e,"本期"),this.getDownTimeTableData()},getTimeFormat:function(){5==this.dateType?(this.bqTimeStr="本月",this.tbTimeStr="上月",this.bqTime=this.$moment(this.selectTime,"YYYY-MM"),this.tbTime=a.i(i.g)(this.$moment(this.selectTime,"YYYY-MM"),-1,5,"YYYY-MM")):8==this.dateType&&(this.bqTimeStr="本年",this.tbTimeStr="上年",this.bqTime=this.$moment(this.selectTime,"YYYY"),this.tbTime=a.i(i.g)(this.$moment(this.selectTime,"YYYY"),-1,5,"YYYY"))},changeTime:function(e,t){e&&(this.dateType=t,this.selectTime=e)},getEnergyTypeList:function(){return this.$ajax({url:"rest/analysisData/energy",method:"get",params:{title:"能源种类"}})},getWorkshopList:function(){return this.$ajax({url:"rest/analysisData/depart",method:"get",params:{title:"车间资料"}})},getEquipTypeList:function(){return this.$ajax({url:"rest/analysisData/equipType",method:"get",params:{title:"设备类型"}})},getEquipList:function(){return this.$ajax({url:"rest/analysisData/equip",method:"get",params:{title:"设备资料"}})},getQueryDataParams:function(){var e=this,t="";return 5==e.dateType?(t=3,e.dateFormat="YYYY-MM",e.xAxisFormat="YYYY年MM月DD日",e.timeNow=this.$moment(e.statisticsTime,"YYYY年MM月")):8==e.dateType&&(t=5,e.dateFormat="YYYY",e.xAxisFormat="YYYY年MM月",e.timeNow=this.$moment(e.statisticsTime,"YYYY年")),{title:"",orgIds:"",targetCycle:t,targetTypes:e.$store.state.targetConstant.targetType.energyConsum,contentTypes:e.$store.state.targetConstant.targetContentType.energy,contentIds:e.energyType,objTypes:e.$store.state.targetConstant.targetSubordinate.equip,objTypeValues:"",isQueryAll:!1,startTime:this.startTime,endTime:this.endTime,isOrgId:!0,isContentType:!0,isObjType:"2"}},getStartEndTime:function(e){var t="";"本期"==e?t=this.selectTime:"环比"==e&&(5==this.dateType?t=a.i(i.g)(this.$moment(this.selectTime,"YYYY-MM"),-1,5,"YYYY-MM"):8==this.dateType&&(t=a.i(i.g)(this.$moment(this.selectTime,"YYYY"),-1,8,"YYYY")));var s=[];5==this.dateType?(s=a.i(i.f)(t,5),this.startTime=s[0],this.endTime=s[1]):8==this.dateType&&(s=a.i(i.f)(t,8),this.startTime=s[0],this.endTime=s[1])},getEgyCspStatisticsTable:function(e,t){var s=this,n=this,r=a.i(i.l)(e);r.title=t+"设备能耗数据",r.startTime=n.startTime,r.endTime=n.endTime,n.$ajax({url:"rest/analysisData/targetData",method:"get",params:r}).then(function(r){if(r.data.status){if("本期"==t)n.energyData=r.data.records,n.getStartEndTime("环比"),n.getEgyCspStatisticsTable(e,"环比");else if("环比"==t){n.hb_energyData=r.data.records,n.egyCspStatisticsTableData=[],n.devEgyCspTableData=[];for(var l=0,o=0,p=!0,u=0;u<n.equipTypeList.length;u++){for(var d=0,m=0,h=0,y=0;y<n.equipList.length;y++)if(n.equipTypeList[u].equipType==n.equipList[y].type){d+=1;for(var c=0;c<n.energyData.length;c++)n.energyData[c].equipId==n.equipList[y].id&&(m+=n.energyData[c].dataValue,n.energyData[c].equipName=n.equipList[y].name,n.energyData[c].equipTypeId=n.equipTypeList[u].equipType),0==c&&(n.unit=n.energyData[c].targetUnit),p&&(o+=n.energyData[c].dataValue);for(var g=0;g<n.hb_energyData.length;g++)n.hb_energyData[g].equipId==n.equipList[y].id&&(h+=n.hb_energyData[g].dataValue,n.hb_energyData[g].equipName=n.equipList[y].name),p&&(l+=n.hb_energyData[g].dataValue);p=!1}0!=d&&n.egyCspStatisticsTableData.push({equipType:n.equipTypeList[u].equipType,equipTypeName:n.equipTypeList[u].equipTypeName,num:d,bqValue:m.toFixed(2),bqScale:0!=o?(m/o*100).toFixed(2)+" %":"--",hbValue:h.toFixed(2),hbScale:0!=l?(h/l*100).toFixed(2)+" %":"--",scale:0!=h?((m-h)/h*100).toFixed(2)+" %":"--"})}n.egyCspTdcyAnalyzeData=n.energyData,a.i(i.o)(n.egyCspTdcyAnalyzeData),n.egyCspProportionData=n.egyCspStatisticsTableData.concat();for(var T=0,b=0,D=0,q=0;q<n.egyCspStatisticsTableData.length;q++)T+=n.egyCspStatisticsTableData[q].num,b+=parseFloat(n.egyCspStatisticsTableData[q].bqValue),D+=parseFloat(n.egyCspStatisticsTableData[q].hbValue);n.egyCspStatisticsTableData.push({equipType:"",equipTypeName:"合计",num:T,bqValue:b.toFixed(2),bqScale:"100%",hbValue:D.toFixed(2),hbScale:"100%",scale:0!=D?((b-D)/D*100).toFixed(2)+" %":"--"});var Y=0,f=0;o=0,l=0;var v="";console.log("energyData",n.energyData),console.log("hb_energyData",n.hb_energyData);for(var C=0;C<n.equipList.length;C++){Y=0,f=0,o=0,l=0;for(var L=0;L<n.energyData.length;L++){n.energyData[L].equipId==n.equipList[C].id&&(Y+=Number(n.energyData[L].dataValue));for(var x=0;x<n.workshopList.length;x++)if(n.equipList[C].orgId==n.workshopList[x].id){v=n.workshopList[x].name;break}o+=Number(n.energyData[L].dataValue)}for(var w=0;w<n.hb_energyData.length;w++)n.hb_energyData[w].equipId==n.equipList[C].id&&(f+=n.hb_energyData[w].dataValue),l+=Number(n.hb_energyData[w].dataValue);n.devEgyCspTableData.push({name:n.equipList[C].name,bqValue:Y.toFixed(2),workshop:v,bqScale:0!=o?(Y/o*100).toFixed(2)+" %":"--",hbValue:f.toFixed(2),hbScale:0!=l?(f/l*100).toFixed(2)+" %":"--",scale:0!=f?((Y-f)/f*100).toFixed(2)+" %":"--"}),n.devEgyCspTableData.sort(n.compare("bqValue"))}}}else s.$message.warning(r.data.answerMsg)})},compare:function(e){return function(t,a){var i=t[e],s=a[e];return isNaN(Number(i))||isNaN(Number(s))||(i=Number(i),s=Number(s)),i>s?-1:i<s?1:0}},getDownTimeTableData:function(e){var t=this,a=this;a.$ajax({url:"rest/analysisData/runningStatic",method:"get",params:{title:"设备停机数据",orgIds:"",objectType:1,objectGroups:"",objectIds:"",status:a.$store.state.targetConstant.equipRunStatus.stop,startTime:a.startTime,endTime:a.endTime,isObjectId:!1,isCount:!0,countCycle:a.dateType,groupBys:"10111"}}).then(function(e){if(e.data.status){var i="";a.downTimeTableData=[];for(var s=0;s<e.data.records.length;s++)for(var n=0;n<a.equipList.length;n++)if(e.data.records[s].objectId==a.equipList[n].id){for(var r=0;r<a.workshopList.length;r++)if(a.equipList[n].orgId==a.workshopList[r].id){i=a.workshopList[r].name;break}a.downTimeTableData.push({name:a.equipList[n].name,hour:(e.data.records[s].stopTimes/3600).toFixed(2),workshop:i,frequency:e.data.records[s].stopNum});break}a.downTimeTableData.sort(a.compare("hour"))}else t.$message.warning(e.data.answerMsg)})},changeEquitmentList:function(){var e=this;e.egyCspTdcyAnalyzeData=[];for(var t=0;t<e.energyData.length;t++)e.energyData[t].equipTypeId==e.equitmentType&&e.energyData[t].organizationId==e.workshop&&(e.egyCspTdcyAnalyzeData=e.egyCspTdcyAnalyzeData.concat(e.energyData[t]))},loadColumn1:function(){return[{label:"设备类型",prop:"equipTypeName"},{label:"设备数量(台)",prop:"num"},{label:this.bqTimeStr+"能耗统计（"+this.bqTime+")",children:[{label:"耗能量",prop:"bqValue"},{label:"占比",prop:"bqScale"}]},{label:this.hbTimeStr+"能耗统计（"+this.tbTime+")",children:[{label:"耗能量",prop:"hbValue"},{label:"占比",prop:"hbScale"}]},{label:"环比",prop:"scale"}]},loadColumn2:function(){return[{label:"设备名称",prop:"name"},{label:this.bqTimeStr+"能耗统计（"+this.bqTime+")",children:[{label:"耗能量",prop:"bqValue"},{label:"占比",prop:"bqScale"}]},{label:this.hbTimeStr+"能耗统计（"+this.tbTime+")",children:[{label:"耗能量",prop:"hbValue"},{label:"占比",prop:"hbScale"}]},{label:"环比",prop:"scale"},{label:"所属部门",prop:"workshop"}]},loadColumn3:function(){return[{label:"设备名称",prop:"name"},{label:this.bqTimeStr+"停机小时数",prop:"hour"},{label:this.bqTimeStr+"停机次数",prop:"frequency"},{label:"所属部门",prop:"workshop"}]}},mounted:function(){this.inintData()}}},kG2u:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("da-panel",{attrs:{"padding-content":"lrtb",padding:"b",noHead:!0}},[e._v("\n    时间：\n    "),a("da-time-select",{attrs:{"time-type":e.dateType,"show-time":[5,8]},on:{"update:timeType":function(t){e.dateType=t},change:e.changeTime},model:{value:e.selectTime,callback:function(t){e.selectTime=t},expression:"selectTime"}}),e._v("\n    能源：\n    "),a("da-radio-select",{attrs:{maxNum:5,"option-lists":e.energyTypeList,label:"name","value-key":"id"},model:{value:e.energyType,callback:function(t){e.energyType=t},expression:"energyType"}}),e._v(" "),a("button",{staticClass:"el-button el-button--primary",attrs:{type:"button"},on:{click:e.loadData}},[a("span",[e._v("查询")])]),e._v(" "),a("p",{staticClass:"pull-right"},[e._v("单位："+e._s(e.unit))])],1),e._v(" "),a("da-panel",{ref:"panelCount",attrs:{title:"设备能耗统计",width:"60%",height:"auto",padding:"rb","padding-content":"lrtb","min-height":"252px"}},[a("da-table",{staticClass:"analysis-table",attrs:{colums:e.columnData1,"table-list":e.egyCspStatisticsTableData}})],1),e._v(" "),a("da-panel",{attrs:{title:"设备类型能耗占比分析","min-height":"200px",width:"40%"}},[a("da-pie-chart",{attrs:{id:"egyCspProportion",title:"设备类型能耗占比分析","data-lists":e.egyCspProportionData,label:"equipTypeName",valueKey:"bqValue"}},[e._v(">")])],1),e._v(" "),a("da-panel",{ref:"panelCount",attrs:{title:"设备能耗排行榜",width:"60%",height:"auto","padding-content":"lrtb","min-height":"200px",padding:"r"}},[a("da-table",{staticClass:"analysis-table",attrs:{colums:e.columnData2,"table-list":e.devEgyCspTableData}})],1),e._v(" "),a("da-panel",{ref:"panelCount",attrs:{title:"设备停机时间排行榜",width:"40%",height:"auto","padding-content":"lrtb","min-height":"200px"}},[a("da-table",{staticClass:"analysis-table",attrs:{colums:e.columnData3,"table-list":e.downTimeTableData}})],1),e._v(" "),a("da-panel",{ref:"panelCount",attrs:{title:"设备能耗趋势分析",width:"100%",height:"auto","min-height":"200px",padding:"tb"}},[a("div",{attrs:{slot:"search"},slot:"search"},[e._v("\n      设备类型：\n      "),a("da-radio-select",{attrs:{maxNum:1,"option-lists":e.equipTypeList,label:"equipTypeName","value-key":"equipType"},on:{change:e.changeEquitmentList},model:{value:e.equitmentType,callback:function(t){e.equitmentType=t},expression:"equitmentType"}}),e._v("\n      部门：\n      "),a("da-radio-select",{attrs:{maxNum:1,"option-lists":e.workshopList,label:"name","value-key":"id"},on:{change:e.changeEquitmentList},model:{value:e.workshop,callback:function(t){e.workshop=t},expression:"workshop"}})],1),e._v(" "),a("da-line-chart",{attrs:{id:"egyCspTdcyAnalyze","date-time":e.selectTime,"data-lists":e.egyCspTdcyAnalyzeData,format:e.dateFormat,"x-axis-format":e.xAxisFormat,"value-key":"dataValue",label:"equipName","x-axis-key":"dataTime"}})],1)],1)},s=[],n={render:i,staticRenderFns:s};t.a=n}});
//# sourceMappingURL=50.839ce1f46030658e5666.js.map