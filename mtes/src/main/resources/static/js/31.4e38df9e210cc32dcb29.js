webpackJsonp([31],{"3O4Q":function(e,t,o){t=e.exports=o("acE3")(!0),t.push([e.i,".role-item-textarea .el-form-item__content{width:180px}.role-div-header .el-input{width:100px}.empower-div-addDialog>.el-dialog{width:750px}.empower-div-addDialog .el-dialog__body{padding:15px 25px}.empower-div-addDialog .plat-header>div{padding-top:1px}.empower-div-addDialog .el-form-item{margin-bottom:5px}.empower-div-addDialog .el-form-item:last-of-type{position:relative;top:-1px;left:0}.empower-div-addDialog .el-input__inner{height:25px}.role-div-addDialog>.el-dialog{width:380px}.role-div-addDialog .el-input{width:180px}.role-div-addDialog .el-dialog__body{overflow:visible}.empowerModule-div-addDialog .el-dialog__body .base-tree{height:450px;overflow:auto}.empowerSource-div-addDialog .el-dialog{width:700px}.empowerSource-div-addDialog .empowerSource-hasModule{height:386px;overflow:auto}.role-copyEmpower-dialog .el-dialog{width:500px}.role-copyEmpower-dialog .role-div-header{justify-content:flex-end}","",{version:3,sources:["C:/vscode/ysems_webapp/src/views/platform/basic/role.vue"],names:[],mappings:"AACA,2CACE,WAAa,CACd,AACD,2BACE,WAAa,CACd,AACD,kCACE,WAAa,CACd,AAKD,wCACE,iBAAmB,CACpB,AACD,wCACE,eAAiB,CAClB,AACD,qCACE,iBAAmB,CACpB,AACD,kDACE,kBAAmB,AACnB,SAAU,AACV,MAAQ,CACT,AACD,wCACE,WAAa,CACd,AACD,+BACE,WAAa,CACd,AACD,8BACE,WAAa,CACd,AACD,qCACE,gBAAkB,CACnB,AACD,yDACE,aAAc,AACd,aAAe,CAChB,AACD,wCACE,WAAa,CACd,AACD,sDACE,aAAc,AACd,aAAe,CAChB,AACD,oCACE,WAAa,CACd,AACD,0CACE,wBAA0B,CAC3B",file:"role.vue",sourcesContent:["\n.role-item-textarea .el-form-item__content {\r\n  width: 180px;\n}\n.role-div-header .el-input {\r\n  width: 100px;\n}\n.empower-div-addDialog > .el-dialog {\r\n  width: 750px;\n}\r\n\r\n/*.empower-div-addDialog .el-input {*/\r\n/*width: 100px;*/\r\n/*}*/\n.empower-div-addDialog .el-dialog__body {\r\n  padding: 15px 25px;\n}\n.empower-div-addDialog .plat-header > div {\r\n  padding-top: 1px;\n}\n.empower-div-addDialog .el-form-item {\r\n  margin-bottom: 5px;\n}\n.empower-div-addDialog .el-form-item:last-of-type {\r\n  position: relative;\r\n  top: -1px;\r\n  left: 0;\n}\n.empower-div-addDialog .el-input__inner {\r\n  height: 25px;\n}\n.role-div-addDialog > .el-dialog {\r\n  width: 380px;\n}\n.role-div-addDialog .el-input {\r\n  width: 180px;\n}\n.role-div-addDialog .el-dialog__body {\r\n  overflow: visible;\n}\n.empowerModule-div-addDialog .el-dialog__body .base-tree {\r\n  height: 450px;\r\n  overflow: auto;\n}\n.empowerSource-div-addDialog .el-dialog {\r\n  width: 700px;\n}\n.empowerSource-div-addDialog .empowerSource-hasModule {\r\n  height: 386px;\r\n  overflow: auto;\n}\n.role-copyEmpower-dialog .el-dialog {\r\n  width: 500px;\n}\n.role-copyEmpower-dialog .role-div-header {\r\n  justify-content: flex-end;\n}\r\n"],sourceRoot:""}])},BKCp:function(e,t,o){"use strict";var r=o("zsLt"),a=o.n(r),i=o("kfHR"),s=o.n(i),l=o("3cXf"),d=o.n(l),n=o("yt7g"),c={name:"",remark:"",entId:""};t.a={name:"role",data:function(){var e=this,t=function(t,o,r){var a=this;if(!o)return r(new Error("不能为空"));e.changeName?(this.checkNameLoading=!0,e.$ajax.get("rest/role/nameIsLegal",{params:{name:o,entId:0},noLoading:!0}).then(function(t){if(a.checkNameLoading=!1,t.data.status){if(!t.data.records)return r(new Error("角色已存在"));r()}else{var o=t.data.answerMsg?t.data.answerMsg:"操作失败";e.$message.error(o)}})):r()};return{checkNameLoading:!1,cs:"1",columns:[{label:"角色名称",prop:"name"},{label:"企业名称",prop:"entId",align:"left",displace:{}},{label:"备注",prop:"remark",align:"left"}],entData:[],orgTreeObj:{},form:{formdata:{name:""},currentPage:1,pageSize:10},tableList:{},empowerForm:{formdata:{name:""},currentPage:1,pageSize:10,exceptId:""},rules:{name:[{required:!0},{validator:t,trigger:"blur"},{max:20,message:"内容不能超过20个字符",trigger:"blur"}],remark:[{max:100,message:"内容不能超过100个字符",trigger:"blur"}]},changeName:!1,tableRow:"",addForm:JSON.parse(d()(c)),title:"",isAdd:!1,addSourceVisible:!1,empowerVisible:!1,transfer:{chooseList:[],accredited:[]},list:{before:[],after:[]},empowerModuleVisible:!1,sourceData:[],sourceDataObj:{},props:{label:"moduleName",children:"children",disabled:function(e,t){return(!e.isNecessary||"0"!==e.isNecessary)&&(!(!e.isNecessary||"1"!==e.isNecessary)||void 0)}},defaultKeys:{nodeKey:"moduleId",expandedKeys:[],checkedKeys:[]},roleId:"",moduleList:{before:[],after:[]},moduleTreeList:[],empowerSourceVisible:!1,activeName:"first",sourceProps:{label:function(e,t){return void 0!==e.resourceName?e.resourceName:e.moduleName},children:"children",disabled:function(e,t){return!!e.isNecessary}},defaultSourceKeys:{nodeKey:"identifyId",checkedKeys:[]},sourceModuleList:{before:[],after:[]},sourceTreeList:[],copyEmpowerVisible:!1}},methods:{request:function(){var e=this,t=this;t.$ajax.get("rest/role/page",{params:t.form,loadingTarget:this.$refs.dataDicTable}).then(function(t){t.data.status&&(e.tableList=t.data)})},empowerRequest:function(){var e=this;e.$ajax.get("rest/role/page/reference",{params:e.empowerForm}).then(function(t){t.data.status&&e.$invokeSubMethod("setData","empowerTable",t.data)})},request2:function(){var e=this;e.$ajax.get("rest/role/user/all",{params:{roleId:e.roleId}}).then(function(t){t.data.status&&(e.transfer.chooseList=t.data.records)}).catch().then(function(){e.$ajax.get("rest/role/user/checked",{params:{roleId:e.roleId}}).then(function(t){e.transfer.accredited=t.data.records,e.list.before=e.transfer.accredited.map(function(e){return e.id})})})},requestOrgTree:function(){var e=this;this.$ajax.get("rest/enterprise/list").then(function(t){if(t.data.status){e.entData=t.data.records;var o={};e.$each(t.data.records,function(e){o[e.id]=e.name}),e.columns[1].displace=o}})},selectForm:function(e){var t=this;e&&(e.hasOwnProperty("type")?t.form.formdata.orgId=e.id:e.hasOwnProperty("subjectionId")?t.form.formdata.parentId=e.id:e.hasOwnProperty("areaName")&&(t.form.formdata.area=e.id))},showAddDialog:function(){this.addSourceVisible=!0,this.isAdd=!0,this.title="新增角色"},lookData:function(e){this.tableRow=e,this.addForm=JSON.parse(d()(e)),this.addSourceVisible=!0,this.title="查看角色"},editData:function(e){this.roleId=e.id,this.tableRow=e,this.addSourceVisible=!0,this.isAdd=!1,this.addForm=JSON.parse(d()(e)),this.title="编辑角色"},empowerUser:function(e){this.roleId=e.id,this.request2(),this.empowerVisible=!0},saveClick:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return e.map(function(e,o){var a={};if(a.roleId=r.roleId,a.userId=e,void 0!==t)for(var i=0;i<r.transfer.accredited.length;i++)r.transfer.accredited[i].id===a.userId&&(a.id=r.transfer.accredited[i].roleUserId);return a})}var t=this,r=this,a=o.i(n.i)(this.list.before,this.list.after);this.$ajax.post("rest/user/roleUser/",{saveList:e(a.saveList),deleteList:e(a.deleteList,"deleteUser")}).then(function(e){e.data.status?(t.$message.success(e.data.answerMsg),t.empowerVisible=!1):t.$message.error(e.data.answerMsg)})},handleRoleChange:function(e){this.list.after=e.value},checkAll:function(e){var t=this;return!(e.children&&e.children.length>0)||(e.children.every(function(e){return 1==e.checked})&&e.children.forEach(function(e){if(e.children&&e.children.length>0)return t.checkAll(e)}),!1)},requestEmpower:function(){var e=this,t=this;this.$ajax.get("rest/role/roleModule",{params:{roleId:this.roleId}}).then(function(r){r.data.status&&(e.$refs.roleModuleTree.setData(r.data.records),t.moduleTreeList=o.i(n.b)(r.data.records,"id","children"),t.moduleTreeList.forEach(function(e){0!=e.checked&&(e.children&&e.children.some(function(e){return e.checked})?(t.moduleList.before.push(e.moduleId),console.log(e.moduleId,e.id,e.moduleName)):e.children||(t.moduleList.before.push(e.moduleId),console.log(e.moduleId,e.id,e.moduleName)),t.checkAll(e)&&t.defaultKeys.checkedKeys.push(e.id))}),r.data.records&&r.data.records.length>0&&t.defaultKeys.expandedKeys.push(r.data.records[0].moduleId))})},empowerModule:function(e){this.roleId=e.id,this.empowerModuleVisible=!0},closeModuleDialog:function(){this.moduleList.before=[],this.defaultKeys={nodeKey:"moduleId",expandedKeys:[],checkedKeys:[]}},closeDialog:function(e){this.changeName=!1,this.$refs[e].resetFields(),this.addForm=JSON.parse(d()(c))},openEmpowerDialog:function(){this.$nextTick(function(){this.requestEmpower()})},closeEmpowerDialog:function(){},saveDialog:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.isAdd?t.$ajax.post("rest/role",t.addForm).then(function(e){e.data.status?(t.$message.success(e.data.answerMsg),t.addSourceVisible=!1,t.request()):t.$message.error(e.data.answerMsg)}).catch(function(e){}):t.$ajax.put("rest/role",t.addForm).then(function(e){e.data.status?(t.$message.success(e.data.answerMsg),t.addSourceVisible=!1,t.request()):t.$message.error(e.data.answerMsg)}).catch(function(e){})})},cancelTreeDialog:function(){this.empowerModuleVisible=!1},saveTreeDialog:function(){function e(t){i.moduleTreeList.forEach(function(o){o.moduleId==t&&o.parentModuleId&&"0"!==o.parentModuleId&&(i.moduleList.after.push(o.parentModuleId),e(o.parentModuleId))})}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return e.map(function(e,o){var r={};if(r.roleId=i.roleId,r.moduleId=e,void 0!==t)for(var a=0;a<i.moduleTreeList.length;a++)i.moduleTreeList[a].moduleId===r.moduleId&&(r.id=i.moduleTreeList[a].id);return r})}var r=this;this.moduleList.after=this.$refs.roleModuleTree.$refs.noLoadTree.getCheckedNodes().map(function(e){return e.moduleId}),console.log(this.defaultKeys.checkedKeys,this.$refs.roleModuleTree.$refs.noLoadTree.getCheckedNodes());var i=this;this.moduleList.after.forEach(function(t){e(t)}),i.moduleList.after=s()(new a.a(i.moduleList.after));var l=o.i(n.i)(this.moduleList.before,this.moduleList.after);if(0===l.saveList.length&&0===l.deleteList)return this.$message.info("模块授权尚未发生变化。"),!1;this.$ajax.post("rest/role/roleModule",{saveList:t(l.saveList),deleteList:t(l.deleteList,"deleteUser")}).then(function(e){e.data.status?(r.$message.success(e.data.answerMsg),r.empowerModuleVisible=!1):r.$message.error(e.data.answerMsg)})},empowerSource:function(e){var t=this;t.roleId=e.id,t.empowerSourceVisible=!0,t.$ajax.get("rest/role/roleModuleHandle",{params:{roleId:t.roleId},noLoading:!0}).then(function(e){t.$refs.roleSourceTree.setData(e.data.records),t.sourceTreeList=o.i(n.b)(e.data.records,"id","children"),t.sourceTreeList.forEach(function(e){(0!=e.checked||e.isNecessary)&&e.handleId&&(t.defaultSourceKeys.checkedKeys.push(e.identifyId),t.sourceModuleList.before.push(e))})})},saveSource:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments[1];return e.map(function(e,r){var a={roleId:t.roleId,handleId:e.handleId,moduleId:e.parentModuleId};return o&&(a.id=e.id),a})}this.sourceModuleList.after=this.$refs.roleSourceTree.$refs.noLoadTree.getCheckedKeys();var t=this,r=t.sourceTreeList.filter(function(e){return t.sourceModuleList.after.some(function(t){return e.identifyId==t&&e.handleId})}),a=o.i(n.i)(this.sourceModuleList.before,r,"identifyId"),i=e(a.saveList),s=e(a.deleteList,"deleteUser");this.$ajax.post("rest/role/roleModuleHandle",{saveList:i,deleteList:s}).then(function(e){e.data.status?(t.$message.success(e.data.answerMsg),t.empowerSourceVisible=!1):t.$message.error(e.data.answerMsg)})},closeEmpowerSource:function(){this.sourceModuleList.before=[],this.sourceModuleList.after=[],this.defaultSourceKeys.checkedKeys=[]},copyEmpower:function(e){this.roleId=e.id,this.empowerForm.exceptId=e.id,this.empowerRequest(),this.copyEmpowerVisible=!0},saveCopeEmpower:function(e){var t=this;this.$ajax.post("rest/role/handle/reference",{roleId:this.roleId,referRoleId:e.id}).then(function(e){e.data.status?t.$message.success(e.data.answerMsg):t.$message.error(e.data.answerMsg)})},closeCopyEmpower:function(){this.empowerForm={formdata:{name:""},currentPage:1,pageSize:10,exceptId:this.roleId}},change:function(e){this.changeName=!0,this.addForm.name=e.replace(/\s+/g,"")}},mounted:function(){this.request(),this.requestOrgTree()},computed:{}}},"D+Pv":function(e,t,o){var r=o("3O4Q");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);o("FIqI")("2d3bc2d4",r,!0,{})},WjbN:function(e,t,o){"use strict";function r(e){o("D+Pv")}Object.defineProperty(t,"__esModule",{value:!0});var a=o("BKCp"),i=o("xrIE"),s=o("J0+h"),l=r,d=s(a.a,i.a,l,null,null);t.default=d.exports},xrIE:function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("da-manage-page",[o("div",{attrs:{slot:"button"},slot:"button"},[o("el-button",{attrs:{icon:"my-xinzeng"},on:{click:e.showAddDialog}},[e._v("\n        新增\n      ")])],1),e._v(" "),o("el-form",{ref:"dataDicForm",attrs:{slot:"search",model:e.form,inline:!0},slot:"search"},[o("el-form-item",{attrs:{label:"名称"}},[o("el-input",{model:{value:e.form.formdata.name,callback:function(t){e.$set(e.form.formdata,"name",t)},expression:"form.formdata.name"}})],1),e._v(" "),o("el-form-item",[o("el-button",{staticClass:"search_button",on:{click:e.request}},[e._v(" 搜索")])],1)],1),e._v(" "),o("da-table",{ref:"dataDicTable",attrs:{slot:"content",colums:e.columns,"table-list":e.tableList,"search-data":e.form},on:{callBack:e.request},slot:"content"},[o("el-table-column",{attrs:{slot:"operation",property:"operation",label:"授权管理",width:"313",align:"center","header-align":"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"small",type:"info"},on:{click:function(o){e.empowerUser(t.row)}}},[e._v("用户配置")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"info"},on:{click:function(o){e.empowerModule(t.row)}}},[e._v("模块配置")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"info"},on:{click:function(o){e.empowerSource(t.row)}}},[e._v("资源配置")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"info"},on:{click:function(o){e.copyEmpower(t.row)}}},[e._v("参照授权")])]}}])}),e._v(" "),o("el-table-column",{attrs:{slot:"operation",property:"operation",label:"操作",width:"60",align:"center","header-align":"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(o){e.editData(t.row)}}},[e._v("编辑")])]}}])})],1),e._v(" "),o("da-dialog",{staticClass:"role-div-addDialog",attrs:{title:e.title,visible:e.addSourceVisible},on:{"update:visible":function(t){e.addSourceVisible=t},close:function(t){e.closeDialog("role_add")}}},[o("el-form",{ref:"role_add",attrs:{"label-width":"95px",model:e.addForm,rules:e.rules,inline:!0}},[o("el-form-item",{attrs:{label:"企业名称",prop:"entId"}},[o("el-select",{attrs:{filterable:"",size:"medium",placeholder:"请选择"},model:{value:e.addForm.entId,callback:function(t){e.$set(e.addForm,"entId",t)},expression:"addForm.entId"}},e._l(e.entData,function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[o("el-input",{directives:[{name:"loading",rawName:"v-loading",value:e.checkNameLoading,expression:"checkNameLoading"}],attrs:{"auto-complete":"off"},on:{change:e.change},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),e._v(" "),o("el-form-item",{staticClass:"role-item-textarea",attrs:{label:"备注",prop:"remark"}},[o("el-input",{attrs:{"auto-complete":"off",type:"textarea",row:3},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveDialog("role_add")}}},[e._v("确 定")]),e._v(" "),o("el-button",{on:{click:function(t){e.addSourceVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),o("da-dialog",{staticClass:"empower-div-addDialog",attrs:{title:"用户配置",visible:e.empowerVisible},on:{"update:visible":function(t){e.empowerVisible=t},close:e.closeEmpowerDialog}},[o("da-transfer",{attrs:{chooseList:e.transfer.chooseList,accredited:e.transfer.accredited,saveClick:e.saveClick,titles:["未授权用户","已授权用户"],buttonTexts:["删除","授权","保存"],emptyText:"当前角色未关联组织机构或关联的组织机构下不存在用户"},on:{transfer:e.handleRoleChange}})],1),e._v(" "),o("da-dialog",{staticClass:"empowerModule-div-addDialog",attrs:{title:"模块配置",visible:e.empowerModuleVisible},on:{"update:visible":function(t){e.empowerModuleVisible=t},open:e.openEmpowerDialog,close:e.closeModuleDialog}},[o("da-tree",{ref:"roleModuleTree",attrs:{props:e.props,"show-checkbox":!0,defaultExpand:!0,defaultKeys:e.defaultKeys}}),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:e.saveTreeDialog}},[e._v("保 存")]),e._v(" "),o("el-button",{on:{click:e.cancelTreeDialog}},[e._v("取 消")])],1)],1),e._v(" "),o("da-dialog",{staticClass:"empowerSource-div-addDialog",attrs:{title:"资源配置",visible:e.empowerSourceVisible},on:{"update:visible":function(t){e.empowerSourceVisible=t},close:e.closeEmpowerSource}},[o("da-tree",{ref:"roleSourceTree",staticClass:"empowerSource-hasModule",attrs:{props:e.sourceProps,defaultExpand:!0,"show-checkbox":!0,defaultKeys:e.defaultSourceKeys}}),e._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:e.saveSource}},[e._v("保 存")]),e._v(" "),o("el-button",{on:{click:function(t){e.empowerSourceVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),o("da-dialog",{staticClass:"role-copyEmpower-dialog",attrs:{title:"参照授权",visible:e.copyEmpowerVisible},on:{"update:visible":function(t){e.copyEmpowerVisible=t},close:e.closeCopyEmpower}},[o("div",{staticClass:"plat-header role-div-header"},[o("el-form",{ref:"dataDicForm",attrs:{model:e.form,inline:!0}},[o("el-form-item",{attrs:{label:"名称"}},[o("el-input",{model:{value:e.empowerForm.formdata.name,callback:function(t){e.$set(e.empowerForm.formdata,"name",t)},expression:"empowerForm.formdata.name"}})],1),e._v(" "),o("el-form-item",[o("el-button",{staticClass:"search_button",on:{click:e.empowerRequest}},[e._v(" 搜索")])],1)],1)],1),e._v(" "),o("da-table",{ref:"empowerTable",attrs:{colums:e.columns,"search-data":e.empowerForm,maxHeight:"400"},on:{callBack:e.empowerRequest}},[o("el-table-column",{attrs:{slot:"operation",property:"operation",label:"操作",width:"80",align:"center","header-align":"center"},slot:"operation",scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"small",type:"info"},on:{click:function(o){e.saveCopeEmpower(t.row)}}},[e._v("参照授权\n            ")])]}}])})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.copyEmpowerVisible=!1}}},[e._v("关 闭")])],1)],1)],1)],1)},a=[],i={render:r,staticRenderFns:a};t.a=i}});
//# sourceMappingURL=31.4e38df9e210cc32dcb29.js.map