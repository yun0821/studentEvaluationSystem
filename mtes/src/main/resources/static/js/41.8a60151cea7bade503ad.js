webpackJsonp([41],{Pjqa:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("da-manage-page",[a("div",{attrs:{slot:"button"},slot:"button"},[a("el-button",{attrs:{icon:"my-zengjia"},on:{click:function(e){t.dialogVisible=!0,t.orgHideNode="",t.getAllList()}}},[t._v("新增")]),t._v(" "),a("el-button",{attrs:{icon:"my-zengjia"},on:{click:function(e){t.meterSetting(t.$refs.meterTb.getCheckedRows())}}},[t._v("采集项批量配置")])],1),t._v(" "),a("el-form",{attrs:{slot:"search",inline:!0,model:t.searchForm.formdata},slot:"search"},[a("el-form-item",{attrs:{label:"表计名称"}},[a("el-input",{model:{value:t.searchForm.formdata.name,callback:function(e){t.$set(t.searchForm.formdata,"name",e)},expression:"searchForm.formdata.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"表计类型"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.searchForm.formdata.instrumentId,callback:function(e){t.$set(t.searchForm.formdata,"instrumentId",e)},expression:"searchForm.formdata.instrumentId"}},t._l(t.instrumentIdOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"计量级别"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.searchForm.formdata.grade,callback:function(e){t.$set(t.searchForm.formdata,"grade",e)},expression:"searchForm.formdata.grade"}},t._l(t.gradeOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"关联能源"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.searchForm.formdata.entEnergyId,callback:function(e){t.$set(t.searchForm.formdata,"entEnergyId",e)},expression:"searchForm.formdata.entEnergyId"}},t._l(t.entEnergyIdOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.getTbList}},[t._v("查询")])],1)],1),t._v(" "),a("da-table",{ref:"meterTb",attrs:{slot:"content",colums:t.colsData,"table-list":t.tableList,"search-data":t.searchForm,"show-selection":!0},on:{callBack:t.getTbList},slot:"content"},[a("el-table-column",{attrs:{slot:"operation",property:"operation",label:"操作",width:"210",align:"center",fixed:"right"},slot:"operation",scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"small"},on:{click:function(a){t.editTb(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(a){t.meterSetting([e.row])}}},[t._v("采集项配置")]),t._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(a){t.delTb(e.row)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("da-dialog",{attrs:{title:t.title,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:function(e){t.closeDialog("addForm")},open:t.openDialog}},[a("el-form",{ref:"addForm",staticClass:"fm-line-50p",attrs:{"label-width":"110px",model:t.addForm,rules:t.rules}},[a("el-form-item",{attrs:{label:"表计名称",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.name,callback:function(e){t.$set(t.addForm,"name",e)},expression:"addForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"表计编号",prop:"no"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.no,callback:function(e){t.$set(t.addForm,"no",e)},expression:"addForm.no"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"表计类型",prop:"instrumentId"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.addForm.instrumentId,callback:function(e){t.$set(t.addForm,"instrumentId",e)},expression:"addForm.instrumentId"}},t._l(t.instrumentIdOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"计量级别",prop:"grade"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.addForm.grade,callback:function(e){t.$set(t.addForm,"grade",e)},expression:"addForm.grade"}},t._l(t.gradeOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"关联能源",prop:"entEnergyId"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.addForm.entEnergyId,callback:function(e){t.$set(t.addForm,"entEnergyId",e)},expression:"addForm.entEnergyId"}},t._l(t.entEnergyIdOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"是否自动采集",prop:"isAutoCollect"}},[a("el-radio-group",{model:{value:t.addForm.isAutoCollect,callback:function(e){t.$set(t.addForm,"isAutoCollect",e)},expression:"addForm.isAutoCollect"}},t._l(t.isAutocollectOptions,function(e){return a("el-radio",{key:e.dataValue,attrs:{label:parseInt(e.dataValue)}},[t._v(t._s(e.dataText))])}))],1),t._v(" "),a("el-form-item",{attrs:{label:"是否停用",prop:"isStopUse"}},[a("el-radio-group",{model:{value:t.addForm.isStopUse,callback:function(e){t.$set(t.addForm,"isStopUse",e)},expression:"addForm.isStopUse"}},t._l(t.isStopuseOptions,function(e){return a("el-radio",{key:e.dataValue,attrs:{label:parseInt(e.dataValue)}},[t._v(t._s(e.dataText))])}))],1),t._v(" "),a("el-form-item",{attrs:{label:"计量种类",prop:"type"}},[a("el-radio-group",{model:{value:t.addForm.type,callback:function(e){t.$set(t.addForm,"type",e)},expression:"addForm.type"}},t._l(t.typeOptions,function(e){return a("el-radio",{key:e.dataValue,attrs:{label:parseInt(e.dataValue)}},[t._v(t._s(e.dataText))])}))],1),t._v(" "),a("el-form-item",{attrs:{label:"使用环节",prop:"purpose"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.addForm.purpose,callback:function(e){t.$set(t.addForm,"purpose",e)},expression:"addForm.purpose"}},t._l(t.purposeOptions,function(t){return a("el-option",{key:t.dataValue,attrs:{label:t.dataText,value:parseInt(t.dataValue)}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"ct",prop:"ct"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.ct,callback:function(e){t.$set(t.addForm,"ct",e)},expression:"addForm.ct"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"pt",prop:"pt"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.pt,callback:function(e){t.$set(t.addForm,"pt",e)},expression:"addForm.pt"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"表底数",prop:"originalData"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.originalData,callback:function(e){t.$set(t.addForm,"originalData",e)},expression:"addForm.originalData"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"安装地址",prop:"address"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.address,callback:function(e){t.$set(t.addForm,"address",e)},expression:"addForm.address"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"出厂编号",prop:"manufacturerNo"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.manufacturerNo,callback:function(e){t.$set(t.addForm,"manufacturerNo",e)},expression:"addForm.manufacturerNo"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"企业管理编号",prop:"manageNo"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.manageNo,callback:function(e){t.$set(t.addForm,"manageNo",e)},expression:"addForm.manageNo"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"安装日期",prop:"installDate"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:t.addForm.installDate,callback:function(e){t.$set(t.addForm,"installDate",e)},expression:"addForm.installDate"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"校验/校准周期",prop:"checkPeriod"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.checkPeriod,callback:function(e){t.$set(t.addForm,"checkPeriod",e)},expression:"addForm.checkPeriod"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"排序",prop:"showSort"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.addForm.showSort,callback:function(e){t.$set(t.addForm,"showSort",e)},expression:"addForm.showSort"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"是否虚拟点",prop:"isInvented"}},[a("el-radio-group",{model:{value:t.addForm.isInvented,callback:function(e){t.$set(t.addForm,"isInvented",e)},expression:"addForm.isInvented"}},t._l(t.isInventedOptions,function(e){return a("el-radio",{key:e.dataValue,attrs:{label:parseInt(e.dataValue)}},[t._v(t._s(e.dataText))])}))],1),t._v(" "),a("el-form-item",{attrs:{label:"用能对象",prop:"orgId"}},[a("el-select",{model:{value:t.addForm.orgId,callback:function(e){t.$set(t.addForm,"orgId",e)},expression:"addForm.orgId"}},t._l(t.orgIdOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"上级回路",prop:"parentId"}},[a("da-select-tree",{ref:"meOrgTree",attrs:{id:"meOrgTree",data:t.parentIdTree,"hide-node":t.orgHideNode,props:{label:"name",children:"children"},"style-attr":"bottom: 40px;"},on:{change:t.selectParentNode},model:{value:t.addForm.parentId,callback:function(e){t.$set(t.addForm,"parentId",e)},expression:"addForm.parentId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"检验到期日期",prop:"dueDate"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:t.addForm.dueDate,callback:function(e){t.$set(t.addForm,"dueDate",e)},expression:"addForm.dueDate"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.saveDialog("addForm")}}},[t._v("确 定")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),a("da-dialog",{attrs:{title:"采集项批量配置",visible:t.dialogSettingVisible,size:"800px"},on:{"update:visible":function(e){t.dialogSettingVisible=e}}},[a("da-table",{ref:"meterItemTb",attrs:{id:"meterItemTb",colums:t.meterItemTb,"table-list":t.meterDataLists,"select-attr":"checked","show-selection":!0}}),t._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.saveMeterItem}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogSettingVisible=!1}}},[t._v("关闭")])],1)],1)],1)},o=[],l={render:r,staticRenderFns:o};e.a=l},iumw:function(t,e,a){"use strict";var r=a("3cXf"),o=a.n(r),l=a("a3Yh"),s=a.n(l),i=a("yt7g"),n=a("yt7g");e.a={name:"meter",data:function(){var t;return{instrumentIdOptions:[],orgIdOptions:[],parentIdTree:[],entData:[],orgHideNode:"",gradeOptions:[{dataText:"进出用能单位",dataValue:"1"},{dataText:"进出主要次级用能单位",dataValue:"2"},{dataText:"主要用能设备",dataValue:"3"}],entEnergyIdOptions:[],isAutocollectOptions:[{dataText:"是",dataValue:"1"},{dataText:"否",dataValue:"0"}],isStopuseOptions:[{dataText:"正常使用",dataValue:"1"},{dataText:"停用",dataValue:"0"}],typeOptions:[{dataText:"能源",dataValue:"1"},{dataText:"非能源",dataValue:"2"}],isInventedOptions:[{dataText:"是",dataValue:"1"},{dataText:"否",dataValue:"0"}],purposeOptions:[{dataValue:1,dataText:"主要生产系统"},{dataValue:2,dataText:"辅助生产系统"},{dataValue:3,dataText:"加工转换系统"},{dataValue:4,dataText:"附属损耗其它"}],searchForm:{formdata:{name:"",instrumentId:"",grade:"",entEnergyId:""},currentPage:1,pageSize:20},tableList:{},colsData:[{label:"表计名称",prop:"name",align:"left",width:"120px",sortable:!0},{label:"用能对象",prop:"orgId",align:"left",width:"120px",sortable:!0},{label:"表计编号",width:"140px",prop:"no",align:"left",sortable:!0},{label:"表计类型",prop:"instrumentId",align:"left",width:"110px",sortable:!0,displace:{}},{label:"计量级别",prop:"grade",width:"160px",align:"left",sortable:!0,displace:{}},{label:"关联能源",prop:"entEnergyId",align:"left",width:"110px",sortable:!0,displace:{}},{label:"是否自动采集",prop:"isAutoCollect",align:"left",width:"130px",sortable:!0,displace:{}},{label:"是否停用",prop:"isStopUse",align:"left",width:"105px",sortable:!0,displace:{}},{label:"计量种类",prop:"type",align:"left",width:"105px",sortable:!0,displace:{}},{label:"使用环节",prop:"purpose",align:"left",sortable:!0,width:"120px",displace:{}},{label:"ct",prop:"ct",align:"left",sortable:!0},{label:"pt",prop:"pt",align:"left",sortable:!0},{label:"表底数",prop:"originalData",width:"100px",align:"left",sortable:!0},(t={label:"安装地址",prop:"address",width:"105px",align:"left"},s()(t,"width","105px"),s()(t,"sortable",!0),t),{label:"出厂编号",prop:"manufacturerNo",width:"105px",align:"left",sortable:!0},{label:"企业管理编号",prop:"manageNo",width:"130px",align:"left",sortable:!0},{label:"安装日期",prop:"installDate",align:"left",format:"YYYY-MM-DD",width:"105px",sortable:!0},{label:"校验/校准周期",prop:"checkPeriod",align:"left",width:"140px",sortable:!0},{label:"排序",prop:"showSort",align:"left",sortable:!0},{label:"虚拟点",prop:"isInvented",align:"left",width:"100px",sortable:!0,displace:{}},{label:"上级回路",prop:"parentId",align:"left",sortable:!0,width:"120px",displace:{}},{label:"检验到期日期",prop:"dueDate",align:"left",format:"YYYY-MM-DD",width:"130px",sortable:!0}],dialogVisible:!1,addForm:{name:"",no:"",instrumentId:"",grade:"",entEnergyId:"",isAutoCollect:1,isStopUse:1,type:1,purpose:1,ct:"1",pt:"1",originalData:"0",address:"",manufacturerNo:"",manageNo:"",installDate:"",checkPeriod:"",showSort:"",isInvented:0,orgId:"",parentId:"",dueDate:""},rules:this.eachValidate({name:{maxString:"40"},no:{maxString:"20"},instrumentId:{},grade:{},entEnergyId:{},isAutoCollect:{},isStopUse:{},type:{},purpose:{},ct:{digits:!0},pt:{digits:!0},originalData:{},address:{maxString:"50"},manufacturerNo:{maxString:"50"},manageNo:{maxString:"50"},installDate:{},checkPeriod:{max:127},showSort:{digits:!0},isInvented:{},orgId:{},parentId:{},dueDate:{}}),dialogSettingVisible:!1,meterDataLists:[],meterItemInitCheck:[],meterIds:"",meterItemTb:[{label:"采集项名称",prop:"energyItemName",sortable:!0},{label:"数据上限",prop:"upperValue",sortable:!0},{label:"数据下限",prop:"lowerValue",sortable:!0},{label:"表码倍率",prop:"rate",sortable:!0},{label:"能耗数据倍率",prop:"dataRate",sortable:!0},{label:"非工作时间上限值",prop:"name",sortable:!0}]}},computed:{title:function(){return this.addForm.id?"编辑表计资料管理":"新增表计资料管理"},urlType:function(){return this.addForm.id?"put":"post"}},watch:{},methods:{getTbList:function(){var t=this;this.$ajax.get("rest/meter/page",{params:this.searchForm,loadingTarget:this.$refs.meterTb}).then(function(e){e.data.status&&(t.tableList=e.data)})},getOrgTree:function(){var t=this;this.$ajax.get("rest/enterprise/list",{noLoading:!0}).then(function(e){e.data.status&&(t.entData=e.data.records)})},getAllList:function(){var t=this;this.$ajax.get("rest/meter/page",{params:{formdata:{name:"",instrumentId:"",grade:"",entEnergyId:""},currentPage:1,pageSize:9999}}).then(function(e){if(e.data.status){t.parentIdTree=a.i(i.m)(e.data.records,"id","parentId");var r={};t.$each(e.data.records,function(t){r[t.id]=t.name}),t.colsData[20].displace=r}})},getInstrumentIdInfo:function(){var t=this;this.$ajax.get("rest/meter/instrumentId/get").then(function(e){if(e.data.status){t.instrumentIdOptions=e.data.records;var a={};t.$each(e.data.records,function(t){a[t.dataValue]=t.dataText}),t.colsData[3].displace=a,e.data.records.length>0&&(t.addForm.instrumentId=e.data.records[0].dataValue)}})},getEntEnergyIdInfo:function(){var t=this;this.$ajax.get("rest/meter/entEnergyId/get").then(function(e){if(e.data.status){t.entEnergyIdOptions=e.data.records;var a={};t.$each(e.data.records,function(t){a[t.dataValue]=t.dataText}),t.colsData[5].displace=a,e.data.records.length>0&&(t.addForm.entEnergyId=e.data.records[0].dataValue)}})},getOrgIdInfo:function(){var t=this;this.$ajax.get("rest/enterpriseOrg/page",{params:{formdata:{name:"",type:""},currentPage:1,pageSize:9999},noLoading:!0}).then(function(e){if(e.data.status){t.orgIdOptions=e.data.records;var a={};t.$each(e.data.records,function(t){a[t.id]=t.name}),t.colsData[1].displace=a}})},openDialog:function(){},editTb:function(t){this.dialogVisible=!0,this.addForm=JSON.parse(o()(t)),this.orgHideNode=t.id},closeDialog:function(t){this.$nextTick(function(){this.$refs[t].resetFields(),this.addForm={name:"",no:"",instrumentId:this.instrumentIdOptions[0].dataValue,grade:"",entEnergyId:this.entEnergyIdOptions[0].dataValue,isAutoCollect:1,isStopUse:1,type:1,purpose:1,ct:"1",pt:"1",originalData:"0",address:"",manufacturerNo:"",manageNo:"",installDate:"",checkPeriod:"",showSort:"",isInvented:0,orgId:"",parentId:"",dueDate:""}})},saveDialog:function(t){var e=this;this.$refs[t].validate(function(t){t&&e.$ajax[e.urlType]("rest/meter",e.addForm).then(function(t){t.data.status?(e.$message.success(t.data.answerMsg),e.dialogVisible=!1,e.getTbList()):e.$message.error(t.data.answerMsg)})})},delTb:function(t){var e=this;this.$confirm("是否删除该记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$ajax.delete("rest/meter",{params:{id:t.id}}).then(function(t){t.data.status?(e.$message.success(t.data.answerMsg),e.getTbList()):e.$message.error(t.data.answerMsg)})})},selectParentNode:function(t,e){t.id===this.addForm.id&&(this.$message.error("用能对象不能以自身作为父节点。"),this.$set(this.addForm,"parentId",e.id))},initTableDisplay:function(){var t={};this.$each(this.gradeOptions,function(e){t[e.dataValue]=e.dataText}),this.colsData[4].displace=t;var e={};this.$each(this.isAutocollectOptions,function(t){e[t.dataValue]=t.dataText}),this.colsData[6].displace=e;var a={};this.$each(this.isStopuseOptions,function(t){a[t.dataValue]=t.dataText}),this.colsData[7].displace=a;var r={};this.$each(this.typeOptions,function(t){r[t.dataValue]=t.dataText}),this.colsData[8].displace=r;var o={};this.$each(this.isInventedOptions,function(t){o[t.dataValue]=t.dataText}),this.colsData[19].displace=o;var l={};this.$each(this.purposeOptions,function(t){l[t.dataValue]=t.dataText}),this.colsData[9].displace=l},meterSetting:function(t){var e=this;if(0===t.length)return this.$message.info("请选择表计。"),!1;this.meterIds=t;var a=this.meterIds.map(function(t){return t.id}).join(",");this.$ajax.get("rest/meter/meterItemList",{params:{meterIds:a}}).then(function(t){t.data.status&&(e.dialogSettingVisible=!0,e.meterItemInitCheck=t.data.records.filter(function(t){return t.checked}),e.$nextTick(function(){e.meterDataLists=t.data.records}))})},saveMeterItem:function(){var t=this,e=[],r=this.meterIds.map(function(t){return t.id}),o=a.i(n.i)(this.meterItemInitCheck,this.$refs.meterItemTb.getCheckedRows(),"energyItemId");a.i(n.i)(this.meterItemInitCheck,o.deleteList,"energyItemId").deleteList.forEach(function(t){var o=t.id.split(",").map(function(t){return t.split("_")[1]});r.forEach(function(r){if(-1===o.indexOf(r.toString())){var l=a.i(n.l)(t);l.meterId=r,l.id="",e.push(l)}})}),o.saveList.forEach(function(t){r.forEach(function(r){var o=a.i(n.l)(t);o.meterId=r,e.push(o)})});var l=[];o.deleteList.forEach(function(t){t.id.split(",").forEach(function(e){var r=a.i(n.l)(t),o=e.split("_");r.id=o[0],r.meterId=o[1],l.push(r)})}),this.$ajax.post("rest/meter/meterItem",{saveList:e,updateList:[],deleteList:l}).then(function(e){e.data.status&&(t.$message.success(e.data.answerMsg),t.dialogSettingVisible=!1)})}},mounted:function(){this.initTableDisplay(),this.getInstrumentIdInfo(),this.getEntEnergyIdInfo(),this.getOrgIdInfo(),this.getOrgTree(),this.getAllList(),this.getTbList()}}},vzGK:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("iumw"),o=a("Pjqa"),l=a("J0+h"),s=l(r.a,o.a,null,null,null);e.default=s.exports}});
//# sourceMappingURL=41.8a60151cea7bade503ad.js.map