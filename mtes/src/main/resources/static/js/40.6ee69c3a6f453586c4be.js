webpackJsonp([40],{Ukit:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("da-equal-panel",{attrs:{width:"100%",height:"auto"}},[a("div",{attrs:{slot:"left"},slot:"left"},[a("da-panel",{ref:"tabQueryTree",attrs:{title:"分组方式",width:"100%",height:"100%","max-height":"824px",padding:"r","padding-content":"tblr",overflow:"auto"}},[a("da-radio-block",{attrs:{"data-lists":e.subitemList,label:"name","value-key":"id"},on:{change:e.getMeterInfo},model:{value:e.subitem,callback:function(t){e.subitem=t},expression:"subitem"}}),e._v(" "),a("da-panel",{attrs:{"no-head":!0,width:"100%",height:"auto",border:!1,padding:"t"}},[a("el-input",{attrs:{placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}}),e._v(" "),a("da-tree",{ref:"tabularTree",attrs:{"data-lists":e.subitemTreeData,"show-checkbox":"","default-expand":!0,"filter-node-method":e.filterNodeMethod},on:{checkChange:e.subitemTreeChange},model:{value:e.meterIds,callback:function(t){e.meterIds=t},expression:"meterIds"}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"right"},slot:"right"},[a("da-panel",{ref:"tabQueryRight",attrs:{title:"实时数据查询",width:"100%",height:"auto","padding-content":"tblr"}},[a("div",{staticStyle:{"padding-bottom":"10px"}},[a("da-radio-block",{attrs:{"data-lists":e.onlineSubitemList,width:"auto",label:"onlineSubitemName","value-key":"id"},model:{value:e.onlineSubitem,callback:function(t){e.onlineSubitem=t},expression:"onlineSubitem"}}),e._v(" "),a("label",[e._v("采集项筛选：")]),e._v(" "),a("div",{staticClass:"inblock",staticStyle:{width:"200px"}},[a("el-select",{attrs:{multiple:"","multiple-limit":5,"collapse-tags":""},model:{value:e.collectSelect,callback:function(t){e.collectSelect=t},expression:"collectSelect"}},e._l(e.collectSelectList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.getCurrentData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.exportTable}},[e._v("导出")])],1),e._v(" "),a("da-table",{ref:"tabbularDataTb",staticClass:"analysis-table",attrs:{colums:e.meterColumnData,"front-page":!0,"table-list":e.meterData}})],1),e._v(" "),a("da-panel",{ref:"tabularEchart",attrs:{title:"历史数据查询",width:"100%",height:"auto","min-height":"200px","padding-content":"tblr"}},[a("div",[a("div",{staticClass:"inblock",staticStyle:{width:"400px"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.timeChange},model:{value:e.pastTime,callback:function(t){e.pastTime=t},expression:"pastTime"}})],1),e._v(" "),a("label",[e._v("采集项筛选：")]),e._v(" "),a("da-radio-select",{attrs:{maxNum:1,"option-lists":e.collectSelectList,label:"name","value-key":"id"},model:{value:e.collectChoose,callback:function(t){e.collectChoose=t},expression:"collectChoose"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.getHistoryData}},[e._v("查询")])],1),e._v(" "),a("da-line-chart",{attrs:{id:"historyDataSearch",label:"meterName",unit:"unit","value-key":"data","x-axis-format":"YYYY-MM-DD HH:mm","data-lists":e.historyData}})],1)],1)])],1)},r=[],s={render:i,staticRenderFns:r};t.a=s},aPMI:function(e,t,a){"use strict";var i=a("yt7g");t.a={data:function(){return{timeType:3,isPickerEnd:!1,subitem:"2",subitemList:[{id:"1",name:"按回路关系",disabled:!0},{id:"2",name:"按计量级别"},{id:"3",name:"按组织架构"},{id:"4",name:"按能源种类"}],searchInput:"",subitemTreeData:[],meterIds:"",onlineSubitem:"",onlineSubitemList:[{id:"1",onlineSubitemName:"全部"},{id:"2",onlineSubitemName:"在线"},{id:"3",onlineSubitemName:"离线"}],meterColumnData:[{label:"表计编号",prop:"no"},{label:"表计名称",prop:"meterName"},{label:"采集项",prop:"energyItemName"},{label:"级别",prop:"grade"},{label:"数据时间",prop:"dataTime",format:"YYYY-MM-DD HH:mm"},{label:"采集时间",prop:"collectTime",format:"YYYY-MM-DD HH:mm"},{label:"数值",prop:"data"}],meterData:[],collectSelect:[],collectSelectList:[],pastTime:[],collectChoose:"",historyDataTime:"",historyData:[],department:[],energy:[],meterDetail:[],grade:[{id:1,name:"一级"},{id:2,name:"二级"},{id:3,name:"三级"}]}},watch:{searchInput:function(e){this.$refs.tabularTree.filter(e)}},methods:{loadData:function(){this.getTree(),this.getCollectSelectList(),this.getCurrentData()},getDepartment:function(){return this.$ajax({url:"rest/analysisData/depart",method:"get",params:{title:"获得部门",orgTypes:null,parentIds:null},loadingTarget:this.$refs.tabQueryTree})},getEnergy:function(){return this.$ajax({url:"rest/analysisData/energy",method:"get",params:{title:"获得能源种类",orgIds:null,equipGroups:null,equipIds:null},loadingTarget:this.$refs.tabQueryTree})},getMeterDetail:function(){return this.$ajax({url:"rest/analysisData/meter",method:"get",params:{title:"表计资料",levels:"",orgIds:"",equipIds:"",instrumentIds:"",entEnergyIds:"",isAutoCollect:"",isStopUse:"",type:"",purposes:"",isInvented:"",energyIds:"",isAll:"true",isCount:"",groupBys:11001e5},loadingTarget:this.$refs.tabQueryTree})},getTree:function(){var e=this;this.$ajax.all([this.getDepartment(),this.getEnergy(),this.getMeterDetail()]).then(function(t){e.department=t[0].data.records,e.energy=t[1].data.records,e.meterDetail=t[2].data.records,e.getMeterInfo()})},getMeterInfo:function(){var e=this;this.subitemTreeData=[],1==this.subitem||(2==this.subitem?function(){e.subitemTreeData=e.grade;for(var t=[],a=0;a<e.subitemTreeData.length;a++)!function(a){e.subitemTreeData[a].children=[],e.meterDetail.forEach(function(i){i.grade==e.subitemTreeData[a].id&&t.indexOf(i.id)<0&&(e.subitemTreeData[a].children.push(i),t.push(i.id))})}(a)}():3==this.subitem?this.department.length>0&&function(){var t=[];e.subitemTreeData=e.department;for(var a=0;a<e.subitemTreeData.length;a++)!function(a){e.subitemTreeData[a].children=[],e.meterDetail.forEach(function(i){i.orgId==e.subitemTreeData[a].id&&t.indexOf(i.id)<0&&(e.subitemTreeData[a].children.push(i),t.push(i.id))})}(a)}():4==this.subitem&&this.energy.length>0&&function(){var t=[];e.subitemTreeData=e.energy;for(var a=0;a<e.subitemTreeData.length;a++)!function(a){e.subitemTreeData[a].children=[],e.meterDetail.forEach(function(i){i.energyId==e.subitemTreeData[a].id&&t.indexOf(i.id)<0&&(e.subitemTreeData[a].children.push(i),t.push(i.id))})}(a)}())},subitemTreeChange:function(e){this.getCollectSelectList()},getCollectSelectList:function(){var e=this;this.$ajax({url:"rest/analysisData/meterEnergyItem",method:"get",params:{title:"表计采集数据项",meterIds:this.meterIds,isMeter:"false"},loadingTarget:this.$refs.tabularEchart}).then(function(t){t.data.status&&(e.collectSelectList=t.data.records,e.getHistoryData())})},loadNode:function(e,t){if(0===e.level)return t([{name:"region1"},{name:"region2"}])},getCurrentData:function(){var e=this,t="";"1"==this.onlineSubitem?t="":"2"==this.onlineSubitem?t="true":"3"==this.onlineSubitem&&(t="false");var a=this.collectSelect.join(",");this.$ajax({url:"rest/analysisData/meterEnergyItemData",method:"get",params:{title:"表计实时数据",meterIds:this.meterIds,energyItemIds:a,onLine:t,startTime:"",endTime:""}}).then(function(t){t.data.status&&(e.meterData=t.data.records)})},timeChange:function(){var e=new Date(this.pastTime[0]),t=new Date(this.pastTime[1]),a=e.getTime();(t.getTime()-a)/1e3>86400&&this.$message.info("选择时间区间不能超过2天")},getHistoryData:function(){var e=this;""==this.collectChoose&&(this.collectChoose=this.collectSelectList[0].id);var t=this.$store.state.targetConstant.targetCycle;this.pastTime.length<2&&(this.pastTime[0]=a.i(i.g)(new Date,-12,t.hour,"YYYY-MM-DD HH:mm:ss"),this.pastTime[1]=a.i(i.g)(new Date,0,t.hour,"YYYY-MM-DD HH:mm:ss"));var r=[];if(r=this.meterIds.split(","),r.length>5)return void this.$message.error("选择项不能超过5个");this.$ajax({url:"rest/analysisData/meterEnergyItemData",method:"get",params:{title:"表计历史数据",meterIds:this.meterIds,energyItemIds:this.collectChoose,onLine:"",startTime:this.pastTime[0],endTime:this.pastTime[1]},loadingTarget:this.$refs.tabularEchart}).then(function(t){t.data.status&&(e.historyData=t.data.records)})},filterNodeMethod:function(e,t){return!e||-1!==t.name.indexOf(e)},exportTable:function(){this.$refs.tabbularDataTb.export("表计实时数据")}},mounted:function(){this.loadData()}}},pRmz:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("aPMI"),r=a("Ukit"),s=a("J0+h"),n=s(i.a,r.a,null,null,null);t.default=n.exports}});
//# sourceMappingURL=40.6ee69c3a6f453586c4be.js.map