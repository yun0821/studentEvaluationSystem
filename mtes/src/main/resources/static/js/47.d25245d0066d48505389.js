webpackJsonp([47],{"/AXc":function(t,a,e){"use strict";var s=e("yt7g");a.a={data:function(){return{workshop:"",workshopList:[],workshops:"",workshopName:"",statisticsTime:"",dateType:5,energyType:"",energyTypeList:[],selectLine:[],compareType:"",compareTypeList:[{name:"环比",id:1},{name:"同比",id:2}],compareTime:"",startTime:new Date,endTime:new Date,tendencyData:[],wspEgyTendencyData:[],dbq_wspEgyTendencyData:[],tdcyCompareTableData:[],workshopDisplace:{},energyQuotaData:[],timeNow:"",energyPptNowData:[],timePast:"",energyPptPastData:[],ergyComparetableData:[],dateFormat:"YYYY-MM",xAxisFormat:"DD日",legendFormat:"YYYY年MM月",columnData:[{label:"对比项",prop:"name"},{label:"数值",prop:"value"}],bqWorkshopTotalData:0,dbqWorkshopTotalData:0,bqTotalData:0,dbqTotalData:0}},methods:{inintData:function(){var t=this;this.compareType=1,this.dateType=5;var a=new Date;a=this.$moment(a,"YYYY-MM"),this.statisticsTime=e.i(s.g)(a,-1,5,"YYYY-MM"),this.compareTime=e.i(s.g)(a,-2,5,"YYYY-MM"),this.$ajax.all([this.getWorkshopList(),this.getEnergyTypeList()]).then(function(a){if(a[0].data.status){t.workshopList=a[0].data.records,t.workshop=a[0].data.records[0].id,t.workshopName=a[0].data.records[0].name;var i={};e.i(s.j)(a[0].data.records,"id","name",i),t.workshopDisplace=i;for(var o in t.workshopList)t.workshops+=t.workshopList[o].id+",";t.workshops=t.workshops.substring(0,t.workshops.length-1)}a[1].data.status&&(t.energyTypeList=a[1].data.records,t.energyType=35),t.$nextTick(function(){t.loadData()})})},loadData:function(){this.wspEgyTendencyData=[],this.energyPptNowData=[],this.energyPptPastData=[],this.ergyComparetableData=[],this.tdcyCompareTableData=[],this.dbqWorkshopTotalData=0,this.dbqTotalData=0,this.bqWorkshopTotalData=0,this.bqTotalData=0,this.getStartEndTime(this.statisticsTime);var t=this.getQueryDataParams();this.getWspEgyTendencyData(t,"本期")},changeTime:function(t,a){t&&(this.dateType=a,this.statisticsTime=t),this.timeChange()},getWorkshopList:function(){return this.$ajax({url:"rest/analysisData/depart",method:"get",params:{title:"车间资料",orgTypes:1}})},getEnergyTypeList:function(){var t=this;return t.$ajax({url:"rest/analysisData/energy",method:"get",params:{title:"能源种类",orgIds:t.workshop}})},ChangeSelectLine:function(){},timeChange:function(){var t=this;1==t.compareType?5==t.dateType?t.compareTime=e.i(s.g)(t.statisticsTime,-1,5,"YYYY-MM"):8==t.dateType&&(t.compareTime=e.i(s.g)(t.statisticsTime,-1,8,"YYYY")):2==t.compareType&&(5==t.dateType?t.compareTime=e.i(s.g)(t.statisticsTime,-1,8,"YYYY-MM"):8==t.dateType&&(t.compareTime=e.i(s.g)(t.statisticsTime,-1,8,"YYYY")))},changeCompareType:function(){this.timeChange(),this.loadData()},changeCompareTime:function(){this.loadData()},changeWorkshop:function(t){this.workshop=t},getQueryDataParams:function(){var t=this,a="";return 5==t.dateType?(a=3,t.dateFormat="YYYY-MM",t.xAxisFormat="DD日",t.legendFormat="YYYY年MM月",t.timeNow=this.$moment(t.statisticsTime,"YYYY年MM月"),t.timePast=this.$moment(t.compareTime,"YYYY年MM月")):8==t.dateType&&(a=5,t.dateFormat="YYYY",t.xAxisFormat="MM月",t.legendFormat="YYYY年",t.timeNow=this.$moment(t.statisticsTime,"YYYY年"),t.timePast=this.$moment(t.compareTime,"YYYY年")),{title:"",orgIds:t.workshops,targetCycle:a,targetTypes:t.$store.state.targetConstant.targetType.energyConsum,contentTypes:t.$store.state.targetConstant.targetContentType.energy,contentIds:t.energyType,objTypes:"",objTypeValues:"",isQueryAll:!1,startTime:"",endTime:"",isOrgId:!0,isContentType:!1,isObjType:""}},getStartEndTime:function(t){var a=[];5==this.dateType?a=e.i(s.f)(t,5):8==this.dateType&&(a=e.i(s.f)(t,8)),this.startTime=a[0],this.endTime=a[1]},getEnergyQuotaData:function(t){var a=this,i=this,o=e.i(s.l)(t);o.title="能耗定额数据",o.orgIds=i.workshop,o.startTime=i.startTime,o.endTime=i.endTime,o.targetTypes=i.$store.state.targetConstant.targetType.energyConsum,o.contentTypes=i.$store.state.targetConstant.targetContentType.energy,o.benchmarkQuota="010",i.$ajax({url:"rest/analysisData/targetBenchmarkData",method:"get",params:o}).then(function(t){t.data.status?null!=t.data.records.quota&&t.data.records.quota.length>0&&(i.energyQuotaData=t.data.records.quota[0].value):(i.energyQuotaData=[],a.$message.warning(t.data.answerMsg))})},getWspEgyTendencyData:function(t,a){var i=this,o=this,n=e.i(s.l)(t);n.title=a+"车间能耗曲线数据",n.startTime=o.startTime,n.endTime=o.endTime,o.$ajax({url:"rest/analysisData/targetData",method:"get",params:n}).then(function(n){if(n.data.status){if("本期"==a){o.tendencyData=n.data.records,o.energyPptNowData=e.i(s.n)(o.tendencyData,"organizationId","dataValue","targetUnit",o.workshopDisplace),e.i(s.o)(o.energyPptNowData,"value",2),o.bqWorkshopTotalData=0,o.bqTotalData=0,console.log("energyPptNowData",o.energyPptNowData);for(var r=0;r<o.energyPptNowData.length;r++)o.workshop==o.energyPptNowData[r].id&&(o.bqWorkshopTotalData=parseFloat(o.energyPptNowData[r].value)),o.bqTotalData+=parseFloat(o.energyPptNowData[r].value);o.getStartEndTime(o.compareTime),o.getWspEgyTendencyData(t,"对比期")}else if("对比期"==a){o.dbq_wspEgyTendencyData=n.data.records,o.tendencyData=o.tendencyData.concat(o.dbq_wspEgyTendencyData),o.energyPptPastData=e.i(s.n)(o.dbq_wspEgyTendencyData,"organizationId","dataValue","targetUnit",o.workshopDisplace),e.i(s.o)(o.energyPptPastData,"value",2),o.dbqWorkshopTotalData=0,o.dbqTotalData=0,console.log("me.workshopName",o.workshopName);for(var l=0;l<o.energyPptPastData.length;l++)o.workshop==o.energyPptPastData[l].id&&(o.dbqWorkshopTotalData=parseFloat(o.energyPptPastData[l].value)),o.dbqTotalData+=parseFloat(o.energyPptPastData[l].value);for(var p=0;p<o.tendencyData.length;p++)o.workshop==o.tendencyData[p].organizationId&&o.wspEgyTendencyData.push(o.tendencyData[p]);e.i(s.o)(o.wspEgyTendencyData),o.dataDispose()}}else i.$message.warning(n.data.answerMsg)})},dataDispose:function(){this.tdcyCompareTableData=[{name:this.timeNow,value:this.bqWorkshopTotalData.toFixed(2)},{name:this.timePast,value:this.dbqWorkshopTotalData.toFixed(2)},{name:"差值",value:(this.bqWorkshopTotalData-this.dbqWorkshopTotalData).toFixed(2)},{name:"变化率",value:((this.bqWorkshopTotalData-this.dbqWorkshopTotalData)/this.dbqWorkshopTotalData*100).toFixed(2)+" %"}],this.ergyComparetableData=[{name:this.timeNow,value:this.bqTotalData.toFixed(2)},{name:this.timePast,value:this.dbqTotalData.toFixed(2)},{name:"差值",value:(this.bqTotalData-this.dbqTotalData).toFixed(2)},{name:"变化率",value:((this.bqTotalData-this.dbqTotalData)/this.dbqTotalData*100).toFixed(2)+" %"}];var t=this.getQueryDataParams();this.getEnergyQuotaData(t)}},mounted:function(){this.inintData()}}},Kjti:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("da-panel",{attrs:{"padding-content":"lrtb",noHead:!0}},[t._v("\n    车间：\n    "),e("da-radio-select",{attrs:{maxNum:1,"option-lists":t.workshopList,label:"name","value-key":"id"},on:{change:t.changeWorkshop},model:{value:t.workshop,callback:function(a){t.workshop=a},expression:"workshop"}}),t._v("\n    时间：\n    "),e("da-time-select",{attrs:{"time-type":t.dateType,"show-time":[5,8]},on:{"update:timeType":function(a){t.dateType=a},change:t.changeTime},model:{value:t.statisticsTime,callback:function(a){t.statisticsTime=a},expression:"statisticsTime"}}),t._v("\n\n    能源：\n    "),e("da-radio-select",{attrs:{maxNum:5,"option-lists":t.energyTypeList,label:"name","value-key":"id"},model:{value:t.energyType,callback:function(a){t.energyType=a},expression:"energyType"}}),t._v(" "),e("button",{staticClass:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.loadData}},[e("span",[t._v("查询")])])],1),t._v(" "),e("da-panel",{ref:"panelCount",attrs:{title:"车间总用能趋势图",width:"100%",height:"auto","min-height":"200px",padding:"tb",border:!1}},[e("div",{attrs:{slot:"search"},slot:"search"},[e("da-radio-select",{attrs:{maxNum:5,"option-lists":t.compareTypeList,label:"name","value-key":"id"},on:{change:t.changeCompareType},model:{value:t.compareType,callback:function(a){t.compareType=a},expression:"compareType"}}),t._v(" "),e("da-time-select",{attrs:{"time-type":t.dateType,"show-time":[5,8],"visible-type":!1},on:{"update:timeType":function(a){t.dateType=a},change:t.changeCompareTime},model:{value:t.compareTime,callback:function(a){t.compareTime=a},expression:"compareTime"}})],1),t._v(" "),e("da-equal-panel",{attrs:{"left-width":null,"right-width":"370px",height:"250px"}},[e("template",{slot:"left"},[e("da-panel",{attrs:{noHead:!0}},[e("da-line-chart",{attrs:{id:"wspEgyTendency","date-time":t.statisticsTime,"data-lists":t.wspEgyTendencyData,format:t.dateFormat,"x-axis-format":t.xAxisFormat,label:"dataTime","x-axis-key":"dataTime","legend-format":t.legendFormat}})],1)],1),t._v(" "),e("template",{slot:"right"},[e("da-panel",{attrs:{"padding-content":"lrtb",noHead:!0,padding:"l","min-height":"252px"}},[e("da-table",{staticClass:"analysis-table",attrs:{colums:t.columnData,"table-list":t.tdcyCompareTableData}})],1)],1)],2)],1),t._v(" "),e("da-panel",{ref:"panelCount",attrs:{title:"车间总用能占比分析",width:"100%",height:"auto","min-height":"200px",padding:"10px 0",border:!1}},[e("da-equal-panel",{attrs:{"left-width":null,height:"250px"}},[e("div",{attrs:{slot:"left"},slot:"left"},[e("da-panel",{attrs:{padding:"r",noHead:!0}},[e("h4",{staticClass:"text-center"},[t._v(t._s(t.timeNow)+"能耗占比")]),t._v(" "),e("da-pie-chart",{attrs:{id:"energyPptNow",title:t.timeNow,"data-lists":t.energyPptNowData,label:"name",valueKey:"value"}})],1)],1),t._v(" "),e("div",{attrs:{slot:"right"},slot:"right"},[e("da-panel",{attrs:{noHead:!0}},[e("h4",{staticClass:"text-center"},[t._v(t._s(t.timePast)+"能耗占比")]),t._v(" "),e("da-pie-chart",{attrs:{id:"energyPptPast",title:t.timePast,"data-lists":t.energyPptPastData,label:"name",valueKey:"value"}})],1)],1),t._v(" "),e("div",{staticStyle:{width:"370px"}},[e("da-panel",{attrs:{padding:"l","padding-content":"lrtb",noHead:!0,height:"271px"}},[e("da-table",{staticClass:"analysis-table",attrs:{colums:t.columnData,"table-list":t.ergyComparetableData}})],1)],1)])],1)],1)},i=[],o={render:s,staticRenderFns:i};a.a=o},"cT/X":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("/AXc"),i=e("Kjti"),o=e("J0+h"),n=o(s.a,i.a,null,null,null);a.default=n.exports}});
//# sourceMappingURL=47.d25245d0066d48505389.js.map